import{c as fe,W as Le,o as se,u as ye,e as be,j as e,S as P,C as h,a as j,b as Q,L as ae,m as w,k as H,aK as Te,al as re,K as S,f as p,i as g,l as Ce,g as he,ax as Re,B as Ae,a5 as Be,Y as _,Z as W,_ as y,$ as m,a0 as X,a1 as d,aM as je,X as Fe,r as E,x as le,aL as ke,D as ie,q as ce,s as de,t as oe,ag as xe,h as Oe,aJ as ue,aN as Me,ah as ne,I as T,aj as me,z as b,v as ve,w as De,aO as pe,F as we,y as C,A as R,E as A,G as B,H as F,n as Z,ai as Ee,J as ee}from"./index-4_aapE8D.js";import{T as Pe,a as $e,b as z,c as V}from"./tabs-D6N9ZXQF.js";import{A as ge}from"./arrow-left-DsycTpTT.js";import{D as qe}from"./dollar-sign-tBBlcmc_.js";import{T as Y}from"./trending-up-CS7Y-F1D.js";import{T as Se}from"./trending-down-DY1KTl3h.js";import{C as Ge}from"./circle-x-BkaoPGm7.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=fe("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=fe("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Ke=["January","February","March","April","May","June","July","August","September","October","November","December"];function He({lease:n,onSuccess:u}){const{toast:l}=se();ye();const[t,i]=E.useState(!1),[s,v]=E.useState(null),[k,D]=E.useState(!1),[a,N]=E.useState(!1),[f,o]=E.useState(!1),[O,$]=E.useState(0),x=c=>{const L=typeof c=="string"?parseFloat(c)||0:c;return Z(L)},U=async()=>{D(!0);try{const L=await(await ee("GET",`/api/leases/${n.id}/settlement`)).json();v(L),$(0),o(!1),N(!1)}catch(c){l({title:"Error",description:c.message,variant:"destructive"})}finally{D(!1)}},J=()=>{i(!0),U()},q=le({mutationFn:async()=>ee("PATCH",`/api/leases/${n.id}/terminate`,{useSecurityDeposit:a,useGlobalLedger:f,globalLedgerAmount:f?O:0}),onSuccess:()=>{S.invalidateQueries({queryKey:[`/api/leases/${n.id}`]}),S.invalidateQueries({queryKey:["/api/leases"]}),S.invalidateQueries({queryKey:["/api/tenants"]}),l({title:"Lease terminated successfully"}),i(!1),u()},onError:c=>{l({title:"Error",description:c.message,variant:"destructive"})}}),M=()=>{if(!s)return 0;let c=s.thisLeaseCurrentDue;return a&&(c=c-s.securityDeposit),f&&O>0&&(c=c-O),c},G=()=>{if(!s||s.globalLedgerBalance>=0)return 0;const c=Math.abs(s.globalLedgerBalance),L=s.thisLeaseCurrentDue-(a?s.securityDeposit:0);return Math.min(c,Math.max(0,L))},I=s&&s.globalLedgerBalance<0,K=s&&s.globalLedgerBalance>0;return e.jsxs(e.Fragment,{children:[e.jsxs(w,{variant:"destructive",onClick:J,disabled:n.status==="terminated",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Terminate Lease"]}),e.jsx(ie,{open:t,onOpenChange:i,children:e.jsxs(ce,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsxs(oe,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(Q,{className:"h-5 w-5"}),"Lease Settlement & Termination"]}),e.jsx(xe,{children:"Review the shop-specific settlement before terminating this lease."})]}),k||!s?e.jsx("div",{className:"py-8 text-center",children:"Loading settlement details..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-base",children:"Lease Information"})}),e.jsxs(j,{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Tenant:"}),e.jsx("p",{className:"font-medium",children:s.tenantName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Shop:"}),e.jsxs("p",{className:"font-medium",children:[s.shopNumber," - ",re(s.floor)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Period:"}),e.jsxs("p",{className:"font-medium",children:[s.startDate," to ",s.endDate]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Monthly Rent:"}),e.jsx("p",{className:"font-medium",children:x(s.monthlyRent)})]})]})]}),e.jsxs(h,{className:"border-2 border-blue-500/50",children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-base flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Shop ",s.shopNumber," - Isolated Settlement"]})}),e.jsxs(j,{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Opening Balance (This Lease):"}),e.jsx("span",{children:x(s.thisLeaseOpeningBalance)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Rent Invoiced:"}),e.jsx("span",{children:x(s.thisLeaseTotalInvoices)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Paid (This Lease):"}),e.jsxs("span",{className:"text-green-600",children:["-",x(s.thisLeaseTotalPaid)]})]}),e.jsx(ue,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsxs("span",{children:["Shop ",s.shopNumber," Settlement Amount:"]}),e.jsx("span",{className:s.thisLeaseCurrentDue>0?"text-red-600":"text-green-600",children:x(s.thisLeaseCurrentDue)})]}),e.jsxs("div",{className:"flex justify-between text-muted-foreground",children:[e.jsx("span",{children:"Security Deposit Available:"}),e.jsx("span",{children:x(s.securityDeposit)})]})]})]}),e.jsxs(h,{className:`border-2 ${I?"border-green-500/50":K?"border-amber-500/50":"border-muted"}`,children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-base flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4"}),"Global Ledger Balance (Other Shops)"]})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Net Balance from Other Leases:"}),e.jsx("span",{className:s.globalLedgerBalance>0?"text-red-600 font-semibold":s.globalLedgerBalance<0?"text-green-600 font-semibold":"",children:s.globalLedgerBalance>0?`${x(s.globalLedgerBalance)} (Due)`:s.globalLedgerBalance<0?`${x(Math.abs(s.globalLedgerBalance))} (Credit)`:x(0)})]}),I&&e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"useGlobalLedger",checked:f,onChange:c=>{o(c.target.checked),c.target.checked||$(0)},className:"h-4 w-4"}),e.jsx(ne,{htmlFor:"useGlobalLedger",className:"cursor-pointer font-medium",children:"Adjust from Global Ledger?"})]}),f&&e.jsxs("div",{className:"space-y-2 pl-7",children:[e.jsx(ne,{className:"text-sm",children:"Amount to transfer from Global Credit:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{type:"number",value:O,onChange:c=>{const L=parseFloat(c.target.value)||0;$(Math.max(0,Math.min(L,G())))},min:0,max:G(),placeholder:"0",className:"w-40"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(max: ",x(G()),")"]})]})]})]}),K&&e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Note: Tenant has outstanding dues on other shops. Settlement here does not affect those."})]})]}),e.jsxs(h,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-base",children:"Settlement Options"})}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"useSecurityDeposit",checked:a,onChange:c=>N(c.target.checked),className:"h-4 w-4"}),e.jsxs(ne,{htmlFor:"useSecurityDeposit",className:"cursor-pointer",children:["Use Security Deposit (",x(s.securityDeposit),") to settle dues"]})]})})]}),e.jsxs(h,{className:"border-2 border-primary",children:[e.jsx(p,{className:"pb-2",children:e.jsx(g,{className:"text-base",children:"Final Settlement Summary"})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Shop ",s.shopNumber," Due:"]}),e.jsx("span",{children:x(s.thisLeaseCurrentDue)})]}),a&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Security Deposit Applied:"}),e.jsxs("span",{className:"text-green-600",children:["-",x(Math.min(s.securityDeposit,s.thisLeaseCurrentDue))]})]}),f&&O>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Global Ledger Transfer:"}),e.jsxs("span",{className:"text-green-600",children:["-",x(O)]})]}),e.jsx(ue,{}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Final Amount:"}),e.jsx("span",{className:M()>0?"text-red-600":M()<0?"text-blue-600":"text-green-600",children:M()>0?`${x(M())} (Tenant Owes)`:M()<0?`${x(Math.abs(M()))} (Return to Tenant)`:x(0)+" (Settled)"})]}),a&&s.securityDeposit>s.thisLeaseCurrentDue&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Remaining Security Deposit to Return:"}),e.jsx("span",{className:"text-blue-600",children:x(s.securityDeposit-Math.min(s.securityDeposit,s.thisLeaseCurrentDue))})]})]})]})]}),e.jsxs(me,{className:"gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(w,{variant:"destructive",onClick:()=>q.mutate(),disabled:q.isPending||k,children:q.isPending?"Terminating...":"Confirm Termination"})]})]})})]})}const Qe=b.object({startDate:b.string().min(1,"Start date is required"),endDate:b.string().min(1,"End date is required"),securityDeposit:b.string().min(1,"Security deposit is required"),monthlyRent:b.string().min(1,"Monthly rent is required"),notes:b.string().optional(),openingDueBalance:b.string().optional()});function Ue({lease:n,onSuccess:u}){var D;const{toast:l}=se(),[t,i]=E.useState(!1),s=ve({resolver:De(Qe),defaultValues:{startDate:n.startDate,endDate:n.endDate,securityDeposit:n.securityDeposit,monthlyRent:n.monthlyRent,notes:n.notes||"",openingDueBalance:n.openingDueBalance||"0"}}),v=le({mutationFn:async a=>ee("PUT",`/api/leases/${n.id}`,{startDate:a.startDate,endDate:a.endDate,securityDeposit:a.securityDeposit,monthlyRent:a.monthlyRent,notes:a.notes,openingDueBalance:a.openingDueBalance}),onSuccess:()=>{S.invalidateQueries({queryKey:[`/api/leases/${n.id}`]}),S.invalidateQueries({queryKey:["/api/leases"]}),l({title:"Lease updated successfully"}),i(!1),u()},onError:a=>{l({title:"Error",description:a.message,variant:"destructive"})}}),k=a=>{v.mutate(a)};return e.jsxs(e.Fragment,{children:[e.jsxs(w,{variant:"outline",onClick:()=>i(!0),disabled:n.status==="terminated",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Edit Lease"]}),e.jsx(ie,{open:t,onOpenChange:i,children:e.jsxs(ce,{className:"sm:max-w-lg",children:[e.jsxs(de,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"Edit Lease"]}),e.jsxs(xe,{children:["Update lease details for Shop ",(D=n.shop)==null?void 0:D.shopNumber]})]}),e.jsx(we,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(k),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(C,{control:s.control,name:"startDate",render:({field:a})=>e.jsxs(R,{children:[e.jsx(A,{children:"Start Date *"}),e.jsx(B,{children:e.jsx(T,{...a,type:"date"})}),e.jsx(F,{})]})}),e.jsx(C,{control:s.control,name:"endDate",render:({field:a})=>e.jsxs(R,{children:[e.jsx(A,{children:"End Date *"}),e.jsx(B,{children:e.jsx(T,{...a,type:"date"})}),e.jsx(F,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(C,{control:s.control,name:"securityDeposit",render:({field:a})=>e.jsxs(R,{children:[e.jsx(A,{children:"Security Deposit (BDT) *"}),e.jsx(B,{children:e.jsx(T,{...a,type:"number",step:"0.01",placeholder:"Advance amount"})}),e.jsx(F,{})]})}),e.jsx(C,{control:s.control,name:"monthlyRent",render:({field:a})=>e.jsxs(R,{children:[e.jsx(A,{children:"Monthly Rent (BDT) *"}),e.jsx(B,{children:e.jsx(T,{...a,type:"number",step:"0.01",placeholder:"Monthly rent amount"})}),e.jsx(F,{})]})})]}),e.jsx(C,{control:s.control,name:"openingDueBalance",render:({field:a})=>e.jsxs(R,{children:[e.jsx(A,{children:"Outstanding Dues (Opening Balance)"}),e.jsx(B,{children:e.jsx(T,{...a,type:"number",step:"0.01",placeholder:"0"})}),e.jsx(F,{})]})}),e.jsx(C,{control:s.control,name:"notes",render:({field:a})=>e.jsxs(R,{children:[e.jsx(A,{children:"Notes"}),e.jsx(B,{children:e.jsx(T,{...a,placeholder:"Additional notes"})}),e.jsx(F,{})]})}),e.jsxs(me,{className:"gap-2 pt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(w,{type:"submit",disabled:v.isPending,children:v.isPending?"Saving...":"Save Changes"})]})]})})]})})]})}const Je=b.object({newRent:b.string().min(1,"New rent amount is required"),effectiveDate:b.string().min(1,"Effective date is required"),agreementTerms:b.string().optional(),notes:b.string().optional()});function ze({leaseId:n,formatValue:u}){const{data:l=[],isLoading:t}=be({queryKey:[`/api/leases/${n}/rent-adjustments`]});return t?e.jsx(h,{children:e.jsx(j,{className:"p-6",children:e.jsx(P,{className:"h-32"})})}):e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(g,{className:"text-base flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5"}),"Rent Adjustment History"]})}),e.jsx(j,{children:e.jsxs(_,{children:[e.jsx(W,{children:e.jsxs(y,{children:[e.jsx(m,{children:"Date"}),e.jsx(m,{children:"Effective From"}),e.jsx(m,{className:"text-right",children:"Previous Rent"}),e.jsx(m,{className:"text-right",children:"New Rent"}),e.jsx(m,{className:"text-right",children:"Change"}),e.jsx(m,{children:"Agreement Terms"}),e.jsx(m,{children:"Notes"})]})}),e.jsxs(X,{children:[l.map(i=>{const s=parseFloat(i.adjustmentAmount);return e.jsxs(y,{children:[e.jsx(d,{children:new Date(i.createdAt).toLocaleDateString()}),e.jsx(d,{children:i.effectiveDate}),e.jsx(d,{className:"text-right",children:u(i.previousRent)}),e.jsx(d,{className:"text-right font-medium",children:u(i.newRent)}),e.jsx(d,{className:`text-right font-medium ${s>0?"text-green-600":"text-red-600"}`,children:e.jsxs("span",{className:"flex items-center justify-end gap-1",children:[s>0?e.jsx(Y,{className:"h-3 w-3"}):e.jsx(Se,{className:"h-3 w-3"}),s>0?"+":"",u(s)]})}),e.jsx(d,{className:"max-w-[200px] truncate",title:i.agreementTerms||"-",children:i.agreementTerms||"-"}),e.jsx(d,{className:"max-w-[200px] truncate",title:i.notes||"-",children:i.notes||"-"})]},i.id)}),l.length===0&&e.jsx(y,{children:e.jsx(d,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No rent adjustments recorded for this lease"})})]})]})})]})}function Ve({lease:n,onSuccess:u}){var f;const{toast:l}=se(),[t,i]=E.useState(!1),s=ve({resolver:De(Je),defaultValues:{newRent:n.monthlyRent,effectiveDate:new Date().toISOString().split("T")[0],agreementTerms:"",notes:""}}),v=le({mutationFn:async o=>ee("POST",`/api/leases/${n.id}/rent-adjustments`,{newRent:o.newRent,effectiveDate:o.effectiveDate,agreementTerms:o.agreementTerms,notes:o.notes}),onSuccess:()=>{S.invalidateQueries({queryKey:[`/api/leases/${n.id}`]}),S.invalidateQueries({queryKey:[`/api/leases/${n.id}/rent-adjustments`]}),S.invalidateQueries({queryKey:["/api/leases"]}),l({title:"Rent adjusted successfully"}),i(!1),s.reset(),u()},onError:o=>{l({title:"Error",description:o.message,variant:"destructive"})}}),k=o=>{v.mutate(o)},D=parseFloat(n.monthlyRent),N=parseFloat(s.watch("newRent")||"0")-D;return e.jsxs(e.Fragment,{children:[e.jsxs(w,{variant:"outline",onClick:()=>i(!0),disabled:n.status==="terminated",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Adjust Rent"]}),e.jsx(ie,{open:t,onOpenChange:i,children:e.jsxs(ce,{className:"sm:max-w-lg",children:[e.jsxs(de,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Adjust Rent"]}),e.jsxs(xe,{children:["Increase or decrease monthly rent for Shop ",(f=n.shop)==null?void 0:f.shopNumber,". This will update future invoices."]})]}),e.jsx(we,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(k),className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-md",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Monthly Rent"}),e.jsx("p",{className:"text-xl font-semibold",children:Z(D)})]}),e.jsx(C,{control:s.control,name:"newRent",render:({field:o})=>e.jsxs(R,{children:[e.jsx(A,{children:"New Monthly Rent (BDT) *"}),e.jsx(B,{children:e.jsx(T,{...o,type:"number",step:"0.01",placeholder:"Enter new rent amount"})}),e.jsx(F,{})]})}),N!==0&&!isNaN(N)&&e.jsxs("div",{className:`p-3 rounded-md flex items-center gap-2 ${N>0?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[N>0?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(Se,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-medium",children:[N>0?"+":"",Z(N)," (",N>0?"Increase":"Decrease",")"]})]}),e.jsx(C,{control:s.control,name:"effectiveDate",render:({field:o})=>e.jsxs(R,{children:[e.jsx(A,{children:"Effective From *"}),e.jsx(B,{children:e.jsx(T,{...o,type:"date"})}),e.jsx(F,{})]})}),e.jsx(C,{control:s.control,name:"agreementTerms",render:({field:o})=>e.jsxs(R,{children:[e.jsx(A,{children:"Agreement Terms"}),e.jsx(B,{children:e.jsx(Ee,{...o,placeholder:"Enter agreement terms for this rent change...",rows:3})}),e.jsx(F,{})]})}),e.jsx(C,{control:s.control,name:"notes",render:({field:o})=>e.jsxs(R,{children:[e.jsx(A,{children:"Notes"}),e.jsx(B,{children:e.jsx(T,{...o,placeholder:"Additional notes"})}),e.jsx(F,{})]})}),e.jsxs(me,{className:"gap-2 pt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(w,{type:"submit",disabled:v.isPending,children:v.isPending?"Saving...":"Apply Adjustment"})]})]})})]})})]})}function ts(){var k,D,a,N,f,o,O,$,x,U,J,q,M,G,I,K,c,L;const[,n]=Le("/leases/:id"),u=n==null?void 0:n.id;se(),ye();const l=r=>{const te=typeof r=="string"?parseFloat(r)||0:r;return Z(te)},{data:t,isLoading:i,error:s}=be({queryKey:[`/api/leases/${u}`],enabled:!!u});if(i)return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(P,{className:"h-10 w-10"}),e.jsxs("div",{children:[e.jsx(P,{className:"h-8 w-48"}),e.jsx(P,{className:"h-4 w-32 mt-2"})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(P,{className:"h-48"}),e.jsx(P,{className:"h-48"})]}),e.jsx(P,{className:"h-96"})]});if(s||!t)return e.jsx("div",{className:"p-6",children:e.jsx(h,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Q,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"Lease not found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The lease you're looking for doesn't exist."}),e.jsx(ae,{href:"/leases",children:e.jsxs(w,{variant:"outline",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Back to Leases"]})})]})})});const v=r=>{switch(r){case"active":return e.jsx(je,{className:"h-4 w-4 text-green-500"});case"expiring_soon":return e.jsx(Ne,{className:"h-4 w-4 text-yellow-500"});case"expired":return e.jsx(Q,{className:"h-4 w-4 text-red-500"});case"terminated":return e.jsx(Ge,{className:"h-4 w-4 text-gray-500"});default:return null}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ae,{href:"/leases",children:e.jsx(w,{variant:"ghost",size:"icon",children:e.jsx(ge,{className:"h-5 w-5"})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h1",{className:"text-2xl font-semibold",children:["Lease: Shop ",(k=t.shop)==null?void 0:k.shopNumber]}),e.jsxs(H,{className:Te(t.status),children:[v(t.status),e.jsx("span",{className:"ml-1 capitalize",children:t.status.replace("_"," ")})]})]}),e.jsxs("p",{className:"text-muted-foreground",children:[(D=t.tenant)==null?void 0:D.name," - ",re(((a=t.shop)==null?void 0:a.floor)||"")]})]})]}),e.jsx("div",{className:"flex gap-2",children:t.status!=="terminated"&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{lease:t,onSuccess:()=>{S.invalidateQueries({queryKey:[`/api/leases/${u}`]})}}),e.jsx(Ue,{lease:t,onSuccess:()=>{S.invalidateQueries({queryKey:[`/api/leases/${u}`]})}}),e.jsx(He,{lease:t,onSuccess:()=>{S.invalidateQueries({queryKey:[`/api/leases/${u}`]})}})]})})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(h,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Lease Period"]})}),e.jsxs(j,{children:[e.jsxs("p",{className:"text-lg font-semibold",children:[new Date(t.startDate).toLocaleDateString("en-GB")," to ",new Date(t.endDate).toLocaleDateString("en-GB")]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Monthly Rent: ",l(t.monthlyRent)]})]})]}),e.jsxs(h,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Security Deposit"]})}),e.jsxs(j,{children:[e.jsx("p",{className:"text-lg font-semibold",children:l(t.securityDeposit)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Used: ",l(t.securityDepositUsed||0)]})]})]}),e.jsxs(h,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4"}),"Outstanding"]})}),e.jsxs(j,{children:[e.jsx("p",{className:`text-lg font-semibold ${(((N=t.summary)==null?void 0:N.totalOutstanding)||0)>0?"text-red-600":"text-green-600"}`,children:l(((f=t.summary)==null?void 0:f.totalOutstanding)||0)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Paid: ",l(((o=t.summary)==null?void 0:o.totalPaid)||0)," / ",l(((O=t.summary)==null?void 0:O.totalInvoiced)||0)]})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(h,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Tenant Details"]})}),e.jsxs(j,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Name:"}),e.jsx(ae,{href:`/tenants/${($=t.tenant)==null?void 0:$.id}`,className:"font-medium text-primary hover:underline",children:(x=t.tenant)==null?void 0:x.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Phone:"}),e.jsx("span",{children:(U=t.tenant)==null?void 0:U.phone})]}),((J=t.tenant)==null?void 0:J.email)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Email:"}),e.jsx("span",{children:(q=t.tenant)==null?void 0:q.email})]})]})]}),e.jsxs(h,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Shop Details"]})}),e.jsxs(j,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shop:"}),e.jsx("span",{className:"font-medium",children:(M=t.shop)==null?void 0:M.shopNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Floor:"}),e.jsx("span",{children:re(((G=t.shop)==null?void 0:G.floor)||"")})]}),((I=t.shop)==null?void 0:I.owner)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Owner:"}),e.jsx("span",{children:t.shop.owner.name})]})]})]})]}),e.jsxs(Pe,{defaultValue:"monthly",className:"w-full",children:[e.jsxs($e,{children:[e.jsx(z,{value:"monthly",children:"Monthly Rent Breakdown"}),e.jsxs(z,{value:"payments",children:["Payment History (",t.payments.length,")"]}),e.jsxs(z,{value:"expenses",children:["Tenant Expenses (",t.expenses.length,")"]}),e.jsx(z,{value:"adjustments",children:"Rent Adjustments"})]}),e.jsx(V,{value:"monthly",className:"mt-4",children:e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(g,{className:"text-base flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5"}),"Monthly Rent Dues"]})}),e.jsx(j,{children:e.jsxs(_,{children:[e.jsx(W,{children:e.jsxs(y,{children:[e.jsx(m,{children:"Month"}),e.jsx(m,{children:"Due Date"}),e.jsx(m,{className:"text-right",children:"Rent Amount"}),e.jsx(m,{className:"text-right",children:"Paid"}),e.jsx(m,{className:"text-right",children:"Outstanding"}),e.jsx(m,{children:"Status"})]})}),e.jsxs(X,{children:[t.monthlyBreakdown.map((r,te)=>e.jsxs(y,{children:[e.jsxs(d,{className:"font-medium",children:[Ke[r.month-1]," ",r.year]}),e.jsx(d,{children:new Date(r.dueDate).toLocaleDateString("en-GB")}),e.jsx(d,{className:"text-right",children:l(r.rentAmount)}),e.jsx(d,{className:"text-right text-green-600",children:r.paidAmount>0?l(r.paidAmount):"-"}),e.jsx(d,{className:`text-right ${r.outstanding>0?"text-red-600 font-medium":""}`,children:r.outstanding>0?l(r.outstanding):"-"}),e.jsx(d,{children:r.outstanding===0?e.jsxs(H,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(je,{className:"h-3 w-3 mr-1"}),"Paid"]}):r.paidAmount>0?e.jsxs(H,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"Partial"]}):e.jsxs(H,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"Due"]})})]},te)),t.monthlyBreakdown.length===0&&e.jsx(y,{children:e.jsx(d,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No rent dues found for this lease"})})]})]})})]})}),e.jsx(V,{value:"payments",className:"mt-4",children:e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(g,{className:"text-base flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"Payment History"]})}),e.jsx(j,{children:e.jsxs(_,{children:[e.jsx(W,{children:e.jsxs(y,{children:[e.jsx(m,{children:"Date"}),e.jsx(m,{className:"text-right",children:"Amount"}),e.jsx(m,{children:"Receipt #"}),e.jsx(m,{children:"Notes"})]})}),e.jsxs(X,{children:[t.payments.map(r=>e.jsxs(y,{children:[e.jsx(d,{children:new Date(r.paymentDate).toLocaleDateString("en-GB")}),e.jsx(d,{className:"text-right text-green-600 font-medium",children:l(r.amount)}),e.jsx(d,{children:r.receiptNumber||"-"}),e.jsx(d,{className:"text-muted-foreground",children:r.notes||"-"})]},r.id)),t.payments.length===0&&e.jsx(y,{children:e.jsx(d,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No payments recorded for this lease"})})]})]})})]})}),e.jsx(V,{value:"expenses",className:"mt-4",children:e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(g,{className:"text-base flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5"}),"Tenant-Related Expenses"]})}),e.jsxs(j,{children:[e.jsxs(_,{children:[e.jsx(W,{children:e.jsxs(y,{children:[e.jsx(m,{children:"Date"}),e.jsx(m,{children:"Category"}),e.jsx(m,{children:"Description"}),e.jsx(m,{className:"text-right",children:"Amount"})]})}),e.jsxs(X,{children:[t.expenses.map(r=>e.jsxs(y,{children:[e.jsx(d,{children:new Date(r.expenseDate).toLocaleDateString("en-GB")}),e.jsx(d,{children:e.jsx(H,{variant:"outline",className:"capitalize",children:r.expenseType})}),e.jsx(d,{children:r.description||"-"}),e.jsx(d,{className:"text-right font-medium",children:l(r.amount)})]},r.id)),t.expenses.length===0&&e.jsx(y,{children:e.jsx(d,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No expenses recorded for this tenant"})})]})]}),t.expenses.length>0&&e.jsx("div",{className:"flex justify-end mt-4 pt-4 border-t",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Expenses"}),e.jsx("p",{className:"text-lg font-semibold",children:l(((K=t.summary)==null?void 0:K.totalExpenses)||0)})]})})]})]})}),e.jsx(V,{value:"adjustments",className:"mt-4",children:e.jsx(ze,{leaseId:t.id,formatValue:l})})]}),(((c=t.summary)==null?void 0:c.grandTotalOutstanding)||0)>0&&e.jsx(h,{className:"border-2 border-orange-200 bg-orange-50 dark:bg-orange-950/20 dark:border-orange-800",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"h-6 w-6 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Total Outstanding (Rent + Expenses)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Security deposit not applied"})]})]}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:l(((L=t.summary)==null?void 0:L.grandTotalOutstanding)||0)})]})})})]})}export{ts as default};
