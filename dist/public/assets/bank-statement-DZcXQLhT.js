const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-COot5vc8.js","assets/index-4_aapE8D.js","assets/index-BBdRFAPp.css"])))=>i.map(i=>d[i]);
import{W as K,r as g,e as Q,j as e,S as B,m as T,L as Z,X as R,a6 as ee,I as A,a8 as Y,a9 as L,aa as z,ab as I,ac as k,a7 as se,C as m,f as j,i as p,a2 as te,a as h,P as le,a5 as ae,l as ne,Y as ce,Z as ie,_ as E,$ as f,a0 as re,a1 as u,n as oe,af as M}from"./index-4_aapE8D.js";import{A as de}from"./arrow-left-DsycTpTT.js";import{D as xe}from"./download-rkSQ5cMz.js";import{T as me}from"./trending-down-DY1KTl3h.js";const V=["January","February","March","April","May","June","July","August","September","October","November","December"];function fe(){const[,F]=K("/owners/:id/bank-statement"),N=F==null?void 0:F.id,[i,w]=g.useState(""),[r,b]=g.useState(""),[o,y]=g.useState("all"),[d,v]=g.useState("all"),_=g.useMemo(()=>{const t=new URLSearchParams;return o!=="all"&&d!=="all"?(t.set("month",o),t.set("year",d)):i&&r&&(t.set("startDate",i),t.set("endDate",r)),t.toString()},[i,r,o,d]),{data:s,isLoading:W,isError:q,error:$}=Q({queryKey:[`/api/owners/${N}/reports/bank-statement`,_],queryFn:async()=>{const t=_?`/api/owners/${N}/reports/bank-statement?${_}`:`/api/owners/${N}/reports/bank-statement`,c=await fetch(t,{credentials:"include"});if(!c.ok){const a=await c.json();throw new Error(a.message||"Failed to fetch report")}return c.json()},enabled:!!N}),n=t=>oe(t),x=t=>t.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),H=()=>{w(""),b(""),y("all"),v("all")},D=i||r||o!=="all"||d!=="all",J=new Date().getFullYear(),O=Array.from({length:6},(t,c)=>J-c),U=async()=>{if(!s)return;const{default:t}=await M(async()=>{const{default:l}=await import("./jspdf.es.min-COot5vc8.js").then(G=>G.j);return{default:l}},__vite__mapDeps([0,1,2])),{default:c}=await M(async()=>{const{default:l}=await import("./jspdf.plugin.autotable-CfO62xhj.js");return{default:l}},[]),a=new t,P=s.owner.name;a.setFontSize(18),a.text(`Financial Statement Report - ${P}`,14,22),a.setFontSize(10);let C="Period: ";o!=="all"&&d!=="all"?C+=`${V[parseInt(o)-1]} ${d}`:i&&r?C+=`${i} to ${r}`:C+="All Time",a.text(C,14,30),a.text(`Generated: ${new Date().toLocaleDateString()}`,14,36);const X=s.data.map(l=>[l.date,l.description,l.type==="rent_collection"?x(l.amount):"",l.type==="bank_deposit"?x(l.amount):"",l.type==="expense"?x(l.amount):""]);c(a,{startY:42,head:[["Date","Description","Rent Collection","Bank Deposit","Expense"]],body:X,styles:{fontSize:8},headStyles:{fillColor:[59,130,246]},columnStyles:{0:{cellWidth:24},1:{cellWidth:80},2:{cellWidth:28,halign:"right"},3:{cellWidth:28,halign:"right"},4:{cellWidth:28,halign:"right"}},didParseCell:function(l){l.section==="body"&&(l.column.index===2&&l.cell.text[0]&&(l.cell.styles.textColor=[37,99,235]),l.column.index===3&&l.cell.text[0]&&(l.cell.styles.textColor=[22,163,74]),l.column.index===4&&l.cell.text[0]&&(l.cell.styles.textColor=[220,38,38]))}});const S=a.lastAutoTable.finalY+10;a.setFontSize(10),a.setTextColor(37,99,235),a.text(`Total Rent Collections: ${x(s.totals.totalRentCollections)}`,14,S),a.setTextColor(22,163,74),a.text(`Total Bank Deposits: ${x(s.totals.totalBankDeposits)}`,14,S+6),a.setTextColor(220,38,38),a.text(`Total Expenses: ${x(s.totals.totalExpenses)}`,14,S+12),a.setTextColor(0,0,0),a.setFontSize(12),a.text(`Net Balance: ${x(s.totals.netBalance)}`,14,S+20),a.save(`financial_statement_${P.replace(/\s+/g,"_")}.pdf`)};return W?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(B,{className:"h-10 w-64"}),e.jsx(B,{className:"h-24 w-full"}),e.jsx(B,{className:"h-96 w-full"})]}):q?e.jsxs("div",{className:"p-6 text-center space-y-4 text-red-500",children:[e.jsx("p",{children:"Failed to load bank statement."}),e.jsx("p",{className:"text-sm font-mono text-muted-foreground",children:$ instanceof Error?$.message:"Unknown error"}),e.jsx(T,{variant:"outline",onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"p-3 md:p-6 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx(Z,{href:`/owners/${N}`,children:e.jsx(T,{variant:"ghost",size:"icon",className:"shrink-0 h-8 w-8 md:h-10 md:w-10",children:e.jsx(de,{className:"h-4 w-4 md:h-5 md:w-5"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h1",{className:"text-lg md:text-2xl font-semibold flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 md:h-6 md:w-6 text-primary"}),e.jsx("span",{className:"truncate",children:"Financial Statement"})]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground truncate",children:s==null?void 0:s.owner.name})]})]}),e.jsxs(T,{onClick:U,disabled:!(s!=null&&s.data.length),size:"sm",className:"shrink-0",children:[e.jsx(xe,{className:"h-4 w-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Export PDF"})]})]}),e.jsx("div",{className:"overflow-x-auto -mx-3 px-3 md:mx-0 md:px-0",children:e.jsxs("div",{className:"flex gap-2 md:gap-3 min-w-max md:min-w-0 md:flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-muted/50 rounded-lg px-2 py-1",children:[e.jsx(ee,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Filters:"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{type:"date",value:i,onChange:t=>{w(t.target.value),y("all"),v("all")},className:"h-8 w-32 text-xs",placeholder:"From"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"}),e.jsx(A,{type:"date",value:r,onChange:t=>{b(t.target.value),y("all"),v("all")},className:"h-8 w-32 text-xs",placeholder:"To"})]}),e.jsxs(Y,{value:o,onValueChange:t=>{y(t),w(""),b("")},children:[e.jsx(L,{className:"h-8 w-28 text-xs",children:e.jsx(z,{placeholder:"Month"})}),e.jsxs(I,{children:[e.jsx(k,{value:"all",children:"All Months"}),V.map((t,c)=>e.jsx(k,{value:String(c+1),children:t.substring(0,3)},c))]})]}),e.jsxs(Y,{value:d,onValueChange:t=>{v(t),w(""),b("")},children:[e.jsx(L,{className:"h-8 w-24 text-xs",children:e.jsx(z,{placeholder:"Year"})}),e.jsxs(I,{children:[e.jsx(k,{value:"all",children:"All Years"}),O.map(t=>e.jsx(k,{value:String(t),children:t},t))]})]}),D&&e.jsx(T,{variant:"ghost",size:"sm",onClick:H,className:"h-8 px-2",children:e.jsx(se,{className:"h-3 w-3"})})]})}),D&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4",children:[e.jsxs(m,{children:[e.jsx(j,{className:"pb-2",children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-blue-600"}),"Rent Collections"]})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n((s==null?void 0:s.totals.totalRentCollections)||0)})})]}),e.jsxs(m,{children:[e.jsx(j,{className:"pb-2",children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-purple-600"}),"Additional Payments"]})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:n((s==null?void 0:s.totals.totalAdditionalPayments)||0)})})]}),e.jsxs(m,{children:[e.jsx(j,{className:"pb-2",children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-green-600"}),"Bank Deposits"]})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n((s==null?void 0:s.totals.totalBankDeposits)||0)})})]}),e.jsxs(m,{children:[e.jsx(j,{className:"pb-2",children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4 text-red-600"}),"Expenses"]})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold text-red-600",children:n((s==null?void 0:s.totals.totalExpenses)||0)})})]}),e.jsxs(m,{children:[e.jsx(j,{className:"pb-2",children:e.jsxs(p,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Net Balance"]})}),e.jsx(h,{children:e.jsx("p",{className:`text-2xl font-bold ${((s==null?void 0:s.totals.netBalance)||0)>=0?"text-green-600":"text-red-600"}`,children:n((s==null?void 0:s.totals.netBalance)||0)})})]})]}),e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs(p,{className:"text-base flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Transaction Details"]})}),e.jsx(h,{children:e.jsxs(ce,{children:[e.jsx(ie,{children:e.jsxs(E,{children:[e.jsx(f,{children:"Date"}),e.jsx(f,{children:"Description"}),e.jsx(f,{className:"text-right text-blue-600",children:"Rent Collection"}),e.jsx(f,{className:"text-right text-purple-600",children:"Additional Payment"}),e.jsx(f,{className:"text-right text-green-600",children:"Bank Deposit"}),e.jsx(f,{className:"text-right text-red-600",children:"Expense"})]})}),e.jsxs(re,{children:[s==null?void 0:s.data.map(t=>e.jsxs(E,{children:[e.jsx(u,{children:t.date}),e.jsx(u,{children:t.description}),e.jsx(u,{className:"text-right font-medium text-blue-600",children:t.type==="rent_collection"?n(t.amount):"-"}),e.jsx(u,{className:"text-right font-medium text-purple-600",children:t.type==="additional_payment"?n(t.amount):"-"}),e.jsx(u,{className:"text-right font-medium text-green-600",children:t.type==="bank_deposit"?n(t.amount):"-"}),e.jsx(u,{className:"text-right font-medium text-red-600",children:t.type==="expense"?n(t.amount):"-"})]},t.id)),(!(s!=null&&s.data)||s.data.length===0)&&e.jsx(E,{children:e.jsx(u,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No transactions found for the selected period"})})]})]})})]}),s&&s.data.length>0&&e.jsx(m,{className:"border-2",children:e.jsx(h,{className:"py-4",children:e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[e.jsxs("div",{className:"flex gap-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Rent Collections"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:n(s.totals.totalRentCollections)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Bank Deposits"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:n(s.totals.totalBankDeposits)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Expenses"}),e.jsx("p",{className:"text-xl font-bold text-red-600",children:n(s.totals.totalExpenses)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Net Balance"}),e.jsx("p",{className:`text-2xl font-bold ${s.totals.netBalance>=0?"text-green-600":"text-red-600"}`,children:n(s.totals.netBalance)})]})]})})})]})}export{fe as default};
