import{r as y,o as B,u as F,e as S,j as e,S as N,C as b,a as v,D as P,p as E,m as g,P as k,q as D,s as X,t as q,L as M,k as T,B as I,g as K,U as L,z as r,v as U,w as $,x as C,F as H,y as d,A as c,E as m,G as o,I as x,H as h,n as Q,J as O,K as A}from"./index-BFK3BxsS.js";import{P as w}from"./phone-DrjSlyW2.js";import{P as z}from"./pen-C680T9lN.js";import{M as R}from"./mail-B_9Wn6jx.js";const V=r.object({name:r.string().min(1,"Name is required"),phone:r.string().optional(),email:r.string().email().optional().or(r.literal("")),address:r.string().optional(),bankName:r.string().optional(),bankAccountNumber:r.string().optional(),bankBranch:r.string().optional()});function G({owner:s,onSuccess:i}){const{toast:l}=B(),n=U({resolver:$(V),defaultValues:{name:(s==null?void 0:s.name)??"",phone:(s==null?void 0:s.phone)??"",email:(s==null?void 0:s.email)??"",address:(s==null?void 0:s.address)??"",bankName:(s==null?void 0:s.bankName)??"",bankAccountNumber:(s==null?void 0:s.bankAccountNumber)??"",bankBranch:(s==null?void 0:s.bankBranch)??""}}),u=C({mutationFn:async a=>O("POST","/api/owners",a),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/owners"]}),l({title:"Owner created successfully"}),i()},onError:a=>{l({title:"Error",description:a.message,variant:"destructive"})}}),j=C({mutationFn:async a=>O("PATCH",`/api/owners/${s==null?void 0:s.id}`,a),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/owners"]}),l({title:"Owner updated successfully"}),i()},onError:a=>{l({title:"Error",description:a.message,variant:"destructive"})}}),f=a=>{s?j.mutate(a):u.mutate(a)},p=u.isPending||j.isPending;return e.jsx(H,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(f),className:"space-y-4",children:[e.jsx(d,{control:n.control,name:"name",render:({field:a})=>e.jsxs(c,{children:[e.jsx(m,{children:"Name *"}),e.jsx(o,{children:e.jsx(x,{...a,placeholder:"Owner name","data-testid":"input-owner-name"})}),e.jsx(h,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:n.control,name:"phone",render:({field:a})=>e.jsxs(c,{children:[e.jsx(m,{children:"Phone"}),e.jsx(o,{children:e.jsx(x,{...a,placeholder:"+880 1XXX-XXXXXX","data-testid":"input-owner-phone"})}),e.jsx(h,{})]})}),e.jsx(d,{control:n.control,name:"email",render:({field:a})=>e.jsxs(c,{children:[e.jsx(m,{children:"Email"}),e.jsx(o,{children:e.jsx(x,{...a,type:"email",placeholder:"email@example.com","data-testid":"input-owner-email"})}),e.jsx(h,{})]})})]}),e.jsx(d,{control:n.control,name:"address",render:({field:a})=>e.jsxs(c,{children:[e.jsx(m,{children:"Address"}),e.jsx(o,{children:e.jsx(x,{...a,placeholder:"Full address","data-testid":"input-owner-address"})}),e.jsx(h,{})]})}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-4",children:"Bank Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:n.control,name:"bankName",render:({field:a})=>e.jsxs(c,{children:[e.jsx(m,{children:"Bank Name"}),e.jsx(o,{children:e.jsx(x,{...a,placeholder:"Bank name","data-testid":"input-owner-bank-name"})}),e.jsx(h,{})]})}),e.jsx(d,{control:n.control,name:"bankBranch",render:({field:a})=>e.jsxs(c,{children:[e.jsx(m,{children:"Branch"}),e.jsx(o,{children:e.jsx(x,{...a,placeholder:"Branch name","data-testid":"input-owner-bank-branch"})}),e.jsx(h,{})]})})]}),e.jsx(d,{control:n.control,name:"bankAccountNumber",render:({field:a})=>e.jsxs(c,{className:"mt-4",children:[e.jsx(m,{children:"Account Number"}),e.jsx(o,{children:e.jsx(x,{...a,placeholder:"Account number","data-testid":"input-owner-account-number"})}),e.jsx(h,{})]})})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-4",children:e.jsx(g,{type:"submit",disabled:p,"data-testid":"button-save-owner",children:p?"Saving...":s?"Update Owner":"Add Owner"})})]})})}function _(){const[s,i]=y.useState(!1),[l,n]=y.useState(null);B(),F();const{data:u=[],isLoading:j}=S({queryKey:["/api/owners"]}),f=t=>{n(t),i(!0)},p=()=>{i(!1),n(null)},a=t=>Q(t);return j?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{className:"h-8 w-40"}),e.jsx(N,{className:"h-4 w-60 mt-2"})]}),e.jsx(N,{className:"h-9 w-32"})]}),e.jsx(b,{children:e.jsx(v,{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(t=>e.jsx(N,{className:"h-16 w-full"},t))})})})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Owners"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage property owners and their bank details"})]}),e.jsxs(P,{open:s,onOpenChange:i,children:[e.jsx(E,{asChild:!0,children:e.jsxs(g,{onClick:()=>n(null),"data-testid":"button-add-owner",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Add Owner"]})}),e.jsxs(D,{className:"sm:max-w-lg",children:[e.jsx(X,{children:e.jsx(q,{children:l?"Edit Owner":"Add New Owner"})}),e.jsx(G,{owner:l??void 0,onSuccess:p})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[u.map(t=>e.jsx(b,{className:"overflow-visible","data-testid":`card-owner-${t.id}`,children:e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-primary/10 text-primary font-semibold",children:t.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0",children:[e.jsx(M,{href:`/owners/${t.id}`,children:e.jsx("h3",{className:"font-semibold truncate text-primary hover:underline cursor-pointer",children:t.name})}),t.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(w,{className:"h-3 w-3"}),e.jsx("span",{children:t.phone})]})]})]}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>f(t),"data-testid":`button-edit-owner-${t.id}`,children:e.jsx(z,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-3",children:[t.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(R,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:t.email})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(T,{variant:"secondary",className:"gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),t.shopCount??0," Shops"]})}),t.bankName&&e.jsxs("div",{className:"pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(K,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:t.bankName}),t.bankBranch&&e.jsxs("span",{className:"text-muted-foreground",children:["- ",t.bankBranch]})]}),t.bankAccountNumber&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 ml-6 font-mono",children:t.bankAccountNumber})]}),e.jsx("div",{className:"pt-3 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Collected"}),e.jsx("span",{className:"font-semibold text-emerald-600 dark:text-emerald-400 tabular-nums",children:a(t.totalCollected??0)})]})})]})]})},t.id)),u.length===0&&e.jsx(b,{className:"col-span-full",children:e.jsxs(v,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(L,{className:"h-12 w-12 text-muted-foreground/50 mb-4"}),e.jsx("h3",{className:"font-semibold mb-1",children:"No owners yet"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Add your first property owner to get started"}),e.jsxs(g,{onClick:()=>i(!0),"data-testid":"button-add-first-owner",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Add Owner"]})]})})]})]})}export{_ as default};
