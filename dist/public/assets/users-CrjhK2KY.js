import{c as ie,bh as le,o as de,bg as ce,r as x,e as J,x as O,j as e,bi as oe,C as N,a as g,aP as A,D as T,p as me,m as l,P as he,q as L,s as M,t as U,ag as q,ah as r,I as i,aw as G,a8 as _,a9 as $,aa as R,ab as H,ac as u,aj as K,f as C,i as b,U as xe,ax as Z,aY as ue,Y as je,Z as pe,_ as Q,$ as o,a0 as Ne,a1 as c,aG as ge,aI as ve,aO as fe,an as we,J as z}from"./index-CAzW3HqC.js";import{f as ye}from"./format-BEMO4FpZ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=ie("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);function Se(){const{isSuperAdmin:S,isLoading:X}=le(),{toast:m}=de(),F=ce(),[ee,v]=x.useState(!1),[se,f]=x.useState(!1),[ae,w]=x.useState(!1),[n,y]=x.useState(null),[h,I]=x.useState(!1),[a,t]=x.useState({username:"",password:"",firstName:"",lastName:"",email:"",phone:"",role:"owner",ownerId:""}),{data:j=[],isLoading:ne}=J({queryKey:["/api/users"],enabled:S}),{data:V=[]}=J({queryKey:["/api/owners"],enabled:S}),E=O({mutationFn:async s=>z("POST","/api/users",{...s,ownerId:s.ownerId?parseInt(s.ownerId):null}),onSuccess:()=>{F.invalidateQueries({queryKey:["/api/users"]}),m({title:"Success",description:"Owner account created successfully."}),v(!1),D()},onError:s=>{m({title:"Error",description:s.message||"Failed to create account",variant:"destructive"})}}),P=O({mutationFn:async({id:s,data:d})=>{const p={...d};return d.ownerId!==void 0&&(p.ownerId=d.ownerId?parseInt(d.ownerId):null),d.password||delete p.password,z("PATCH",`/api/users/${s}`,p)},onSuccess:()=>{F.invalidateQueries({queryKey:["/api/users"]}),m({title:"Success",description:"User updated successfully."}),f(!1),y(null),D()},onError:s=>{m({title:"Error",description:s.message||"Failed to update user",variant:"destructive"})}}),k=O({mutationFn:async s=>z("DELETE",`/api/users/${s}`),onSuccess:()=>{F.invalidateQueries({queryKey:["/api/users"]}),m({title:"Success",description:"User deleted successfully."}),w(!1),y(null)},onError:s=>{m({title:"Error",description:s.message||"Failed to delete user",variant:"destructive"})}}),D=()=>{t({username:"",password:"",firstName:"",lastName:"",email:"",phone:"",role:"owner",ownerId:""}),I(!1)},te=s=>{var d;y(s),t({username:s.username,password:"",firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",phone:s.phone||"",role:s.role,ownerId:((d=s.ownerId)==null?void 0:d.toString())||""}),f(!0)},re=s=>{y(s),w(!0)};return X||ne?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(oe,{className:"h-8 w-8 animate-spin text-primary"})}):S?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage owner accounts"})]}),e.jsxs(T,{open:ee,onOpenChange:v,children:[e.jsx(me,{asChild:!0,children:e.jsxs(l,{onClick:()=>{D(),v(!0)},children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Create Owner Account"]})}),e.jsxs(L,{children:[e.jsxs(M,{children:[e.jsx(U,{children:"Create Owner Account"}),e.jsx(q,{children:"Create a new login account for a property owner"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"firstName",children:"First Name"}),e.jsx(i,{id:"firstName",value:a.firstName,onChange:s=>t({...a,firstName:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"lastName",children:"Last Name"}),e.jsx(i,{id:"lastName",value:a.lastName,onChange:s=>t({...a,lastName:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"email",children:"Email"}),e.jsx(i,{id:"email",type:"email",value:a.email,onChange:s=>t({...a,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"phone",children:"Phone"}),e.jsx(i,{id:"phone",value:a.phone,onChange:s=>t({...a,phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"username",children:"Username *"}),e.jsx(i,{id:"username",value:a.username,onChange:s=>t({...a,username:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"password",children:"Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{id:"password",type:h?"text":"password",value:a.password,onChange:s=>t({...a,password:s.target.value}),required:!0}),e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>I(!h),children:h?e.jsx(W,{className:"h-4 w-4"}):e.jsx(G,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"ownerId",children:"Link to Owner"}),e.jsxs(_,{value:a.ownerId||"none",onValueChange:s=>t({...a,ownerId:s==="none"?"":s}),children:[e.jsx($,{children:e.jsx(R,{placeholder:"Select an owner (optional)"})}),e.jsxs(H,{children:[e.jsx(u,{value:"none",children:"No owner linked"}),V.map(s=>e.jsx(u,{value:s.id.toString(),children:s.name},s.id))]})]})]})]}),e.jsxs(K,{children:[e.jsx(l,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(l,{onClick:()=>E.mutate(a),disabled:!a.username||!a.password||E.isPending,children:E.isPending?"Creating...":"Create Account"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(N,{children:[e.jsx(C,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Total Users"})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-2xl font-bold",children:j.length})]})})]}),e.jsxs(N,{children:[e.jsx(C,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Super Admins"})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-2xl font-bold",children:j.filter(s=>s.role==="super_admin").length})]})})]}),e.jsxs(N,{children:[e.jsx(C,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Owners"})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-2xl font-bold",children:j.filter(s=>s.role==="owner").length})]})})]})]}),e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsx(b,{children:"Users"}),e.jsx(ue,{children:"Manage all user accounts and their permissions"})]}),e.jsx(g,{children:e.jsxs(je,{children:[e.jsx(pe,{children:e.jsxs(Q,{children:[e.jsx(o,{children:"User"}),e.jsx(o,{children:"Username"}),e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Phone"}),e.jsx(o,{children:"Role"}),e.jsx(o,{children:"Linked Owner"}),e.jsx(o,{children:"Joined"}),e.jsx(o,{className:"text-right",children:"Actions"})]})}),e.jsxs(Ne,{children:[j.map(s=>{var Y,B;const d=s.firstName&&s.lastName?`${s.firstName[0]}${s.lastName[0]}`.toUpperCase():((B=(Y=s.username)==null?void 0:Y[0])==null?void 0:B.toUpperCase())||"U",p=s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.username;return e.jsxs(Q,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"h-8 w-8",children:e.jsx(ve,{className:"bg-primary/10 text-primary text-xs",children:d})}),e.jsx("span",{className:"font-medium",children:p})]})}),e.jsx(c,{className:"font-mono text-sm",children:s.username}),e.jsx(c,{className:"text-muted-foreground",children:s.email||"-"}),e.jsx(c,{className:"text-muted-foreground",children:s.phone||"-"}),e.jsx(c,{children:s.role==="super_admin"?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-primary",children:[e.jsx(A,{className:"h-3 w-3"})," Super Admin"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-blue-600",children:[e.jsx(Z,{className:"h-3 w-3"})," Owner"]})}),e.jsx(c,{children:s.ownerDetails?e.jsx("span",{className:"text-sm",children:s.ownerDetails.name}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})}),e.jsx(c,{className:"text-muted-foreground text-sm",children:s.createdAt?ye(new Date(s.createdAt),"MMM d, yyyy"):"-"}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>te(s),children:e.jsx(fe,{className:"h-4 w-4"})}),s.username!=="super_admin"&&e.jsx(l,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>re(s),children:e.jsx(we,{className:"h-4 w-4"})})]})})]},s.id)}),j.length===0&&e.jsx(Q,{children:e.jsx(c,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"No users found. Create an owner account to get started."})})]})]})})]}),e.jsx(T,{open:se,onOpenChange:f,children:e.jsxs(L,{children:[e.jsxs(M,{children:[e.jsx(U,{children:"Edit User"}),e.jsx(q,{children:"Update user account details"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"editFirstName",children:"First Name"}),e.jsx(i,{id:"editFirstName",value:a.firstName,onChange:s=>t({...a,firstName:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"editLastName",children:"Last Name"}),e.jsx(i,{id:"editLastName",value:a.lastName,onChange:s=>t({...a,lastName:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"editEmail",children:"Email"}),e.jsx(i,{id:"editEmail",type:"email",value:a.email,onChange:s=>t({...a,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"editPhone",children:"Phone"}),e.jsx(i,{id:"editPhone",value:a.phone,onChange:s=>t({...a,phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"editUsername",children:"Username"}),e.jsx(i,{id:"editUsername",value:a.username,onChange:s=>t({...a,username:s.target.value}),disabled:(n==null?void 0:n.username)==="super_admin"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"editPassword",children:"New Password (leave empty to keep current)"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{id:"editPassword",type:h?"text":"password",value:a.password,onChange:s=>t({...a,password:s.target.value}),placeholder:"Enter new password"}),e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>I(!h),children:h?e.jsx(W,{className:"h-4 w-4"}):e.jsx(G,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"editRole",children:"Role"}),e.jsxs(_,{value:a.role,onValueChange:s=>t({...a,role:s}),disabled:(n==null?void 0:n.username)==="super_admin",children:[e.jsx($,{children:e.jsx(R,{})}),e.jsxs(H,{children:[e.jsx(u,{value:"super_admin",children:"Super Admin"}),e.jsx(u,{value:"owner",children:"Owner"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"editOwnerId",children:"Link to Owner"}),e.jsxs(_,{value:a.ownerId||"none",onValueChange:s=>t({...a,ownerId:s==="none"?"":s}),children:[e.jsx($,{children:e.jsx(R,{placeholder:"Select an owner (optional)"})}),e.jsxs(H,{children:[e.jsx(u,{value:"none",children:"No owner linked"}),V.map(s=>e.jsx(u,{value:s.id.toString(),children:s.name},s.id))]})]})]})]}),e.jsxs(K,{children:[e.jsx(l,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(l,{onClick:()=>n&&P.mutate({id:n.id,data:a}),disabled:P.isPending,children:P.isPending?"Saving...":"Save Changes"})]})]})}),e.jsx(T,{open:ae,onOpenChange:w,children:e.jsxs(L,{children:[e.jsxs(M,{children:[e.jsx(U,{children:"Delete User"}),e.jsxs(q,{children:['Are you sure you want to delete the account for "',n==null?void 0:n.firstName," ",n==null?void 0:n.lastName,'" (',n==null?void 0:n.username,")? This action cannot be undone."]})]}),e.jsxs(K,{children:[e.jsx(l,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:()=>n&&k.mutate(n.id),disabled:k.isPending,children:k.isPending?"Deleting...":"Delete Account"})]})]})})]}):e.jsx("div",{className:"p-6",children:e.jsx(N,{children:e.jsxs(g,{className:"p-6 text-center",children:[e.jsx(A,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground",children:"You do not have permission to access this page."})]})})})}export{Se as default};
