import{c as V,W as ge,u as X,e as de,j as e,S as z,L as W,m as v,aG as fe,aH as Ne,aI as ye,C as P,f as k,i as M,a as T,X as ae,g as K,aJ as oe,l as ne,k as L,h as ve,aK as be,al as we,a5 as re,z as C,o as U,r as j,J as O,x as B,D as Z,aL as Se,q as ee,s as Q,t as _,b as le,ai as se,v as De,w as Ce,p as me,F as Ae,y as R,A as E,E as I,G as q,H as $,I as F,P as ie,n as J,K as A}from"./index-CAzW3HqC.js";import{A as ce}from"./arrow-left-BMmtmNbG.js";import{P as Pe}from"./phone-BklwAKgw.js";import{M as ke}from"./mail-CJ1bafBL.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=V("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=V("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=V("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=V("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=V("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]),Re=C.object({amount:C.string().min(1,"Amount is required"),paymentDate:C.string().min(1,"Date is required"),rentMonths:C.array(C.string()).min(1,"Please select at least one rent month"),leaseId:C.string().min(1,"Please select a lease"),receiptNumber:C.string().optional(),notes:C.string().optional()}),Ee=["January","February","March","April","May","June","July","August","September","October","November","December"];function Ie(i){if(!i)return[];const g=[],s=new Date(i),b=new Date;let n=new Date(s.getFullYear(),s.getMonth(),1);for(;n<=b;){const u=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`,l=`${Ee[n.getMonth()]} ${n.getFullYear()}`;g.push({value:u,label:l}),n.setMonth(n.getMonth()+1)}return g}function qe({lease:i,tenant:g,onSuccess:s}){const{toast:b}=U();X();const[n,u]=j.useState(!1),[l,t]=j.useState(null),[m,o]=j.useState(!1),[f,S]=j.useState(""),c=d=>{const h=typeof d=="string"?parseFloat(d)||0:d;return J(h)};j.useEffect(()=>{n&&(o(!0),S(""),O("GET",`/api/leases/${i.id}/settlement`).then(d=>d.json()).then(d=>{t(d),o(!1)}).catch(d=>{b({title:"Error",description:d.message,variant:"destructive"}),o(!1)}))},[n,i.id]);const N=B({mutationFn:async()=>O("PATCH",`/api/leases/${i.id}/terminate`,{terminationNotes:f}),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/tenants",g.id]}),A.invalidateQueries({queryKey:["/api/leases"]}),b({title:"Lease terminated successfully"}),u(!1),s()},onError:d=>{b({title:"Error",description:d.message,variant:"destructive"})}});return e.jsxs(Z,{open:n,onOpenChange:u,children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>u(!0),className:"text-red-600 dark:text-red-400","data-testid":`button-terminate-lease-${i.id}`,children:[e.jsx(Se,{className:"h-4 w-4 mr-1"}),"Terminate"]}),e.jsx(ee,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:m||!l?e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:e.jsxs(_,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(le,{className:"h-5 w-5"}),"Lease Settlement & Termination"]})}),e.jsx("div",{className:"py-8 text-center",children:"Loading settlement details..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:e.jsxs(_,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(le,{className:"h-5 w-5"}),"Lease Settlement & Termination"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-muted p-4 rounded-lg",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Tenant:"}),e.jsx("span",{className:"font-medium",children:l.tenantName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shop:"}),e.jsxs("span",{className:"font-medium",children:[l.shopNumber," - ",l.floor]})]})]})}),e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Settlement Calculation"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-muted-foreground",children:"Opening Balance"}),e.jsx("span",{className:"font-medium tabular-nums",children:c(l.openingBalance)})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Rent Invoices"}),e.jsx("span",{className:"font-medium tabular-nums",children:c(l.totalInvoices)})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Paid"}),e.jsxs("span",{className:"font-medium text-emerald-600 dark:text-emerald-400 tabular-nums",children:["-",c(l.totalPaid)]})]})]}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-950/20 p-3 rounded-md my-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Outstanding Due"}),e.jsx("span",{className:`text-lg font-bold tabular-nums ${l.currentDue>0?"text-red-600 dark:text-red-400":"text-emerald-600 dark:text-emerald-400"}`,children:c(l.currentDue)})]})}),e.jsxs("div",{className:"space-y-2 bg-blue-50 dark:bg-blue-950/20 p-3 rounded-md",children:[e.jsxs("h4",{className:"font-semibold text-sm flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Security Deposit Adjustment"]}),e.jsxs("div",{className:"flex justify-between py-1 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Security Deposit"}),e.jsx("span",{className:"tabular-nums",children:c(l.securityDeposit)})]}),e.jsxs("div",{className:"flex justify-between py-1 text-sm border-t pt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount to Deduct"}),e.jsxs("span",{className:"font-semibold text-amber-600 dark:text-amber-400 tabular-nums",children:["-",c(l.securityDepositUsed)]})]}),e.jsxs("div",{className:"flex justify-between py-1 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Remaining Deposit"}),e.jsx("span",{className:"font-medium tabular-nums",children:c(l.remainingSecurityDeposit)})]})]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-950/20 p-3 rounded-md",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Final Settlement Amount"}),e.jsx("span",{className:`text-lg font-bold tabular-nums ${l.finalSettledAmount>0?"text-red-600 dark:text-red-400":"text-emerald-600 dark:text-emerald-400"}`,children:c(l.finalSettledAmount)})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Settlement Notes"}),e.jsx(se,{value:f,onChange:d=>S(d.target.value),placeholder:"Document how both parties agreed to settle the amount (e.g., security deposit adjustment, waiver of dues, payment plan, etc.)",rows:3,className:"resize-none"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Record details of any agreements made between owner and tenant regarding final settlement."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(v,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(v,{variant:"destructive",onClick:()=>N.mutate(),disabled:N.isPending,children:N.isPending?"Terminating...":"Confirm Termination"})]})]})]})})]})}function $e({tenant:i,leases:g,onSuccess:s}){const{toast:b}=U();X();const[n,u]=j.useState(!1),[l,t]=j.useState([]),m=g.filter(a=>a.status==="active"||a.status==="expiring_soon"),o=m.length===1?m[0].id.toString():"",[f,S]=j.useState(o),c=m.find(a=>a.id.toString()===f),N=Ie(c==null?void 0:c.startDate),d=c?parseFloat(c.monthlyRent):0,h=i.currentDue||0,p=l.length,w=d*p,D=w+h,x=De({resolver:Ce(Re),defaultValues:{amount:"",paymentDate:new Date().toISOString().split("T")[0],rentMonths:[],leaseId:o,receiptNumber:"",notes:""}}),G=()=>{x.setValue("amount",D.toString())},r=a=>{t(y=>{const te=y.includes(a)?y.filter(je=>je!==a):[...y,a].sort();return x.setValue("rentMonths",te),te})},xe=()=>{const a=N.map(y=>y.value);t(a),x.setValue("rentMonths",a)},ue=()=>{t([]),x.setValue("rentMonths",[])},he=a=>{S(a),x.setValue("leaseId",a),t([]),x.setValue("rentMonths",[]),x.setValue("amount","")},Y=B({mutationFn:async a=>O("POST","/api/payments",{tenantId:i.id,leaseId:parseInt(a.leaseId),amount:a.amount,paymentDate:a.paymentDate,rentMonths:a.rentMonths,receiptNumber:a.receiptNumber,notes:a.notes}),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/tenants",i.id]}),A.invalidateQueries({queryKey:["/api/payments"]}),A.invalidateQueries({queryKey:["/api/dashboard/stats"]}),b({title:"Payment recorded successfully"}),u(!1),x.reset(),t([]),s()},onError:a=>{b({title:"Error",description:a.message,variant:"destructive"})}}),pe=a=>{Y.mutate(a)},H=a=>J(a);return m.length===0?e.jsxs(v,{disabled:!0,variant:"secondary",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"No Active Lease"]}):e.jsxs(Z,{open:n,onOpenChange:u,children:[e.jsx(me,{asChild:!0,children:e.jsxs(v,{"data-testid":"button-receive-payment",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Receive Payment"]})}),e.jsxs(ee,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(Q,{children:e.jsxs(_,{children:["Receive Payment from ",i.name]})}),e.jsx(Ae,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(pe),className:"space-y-4",children:[m.length>1&&e.jsx(R,{control:x.control,name:"leaseId",render:({field:a})=>e.jsxs(E,{children:[e.jsx(I,{children:"Lease *"}),e.jsx(q,{children:e.jsxs("select",{...a,onChange:y=>he(y.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm","data-testid":"select-payment-lease",children:[e.jsx("option",{value:"",children:"Select lease"}),m.map(y=>e.jsxs("option",{value:y.id,children:["Shop ",y.shop.shopNumber," - ",H(parseFloat(y.monthlyRent)),"/month"]},y.id))]})}),e.jsx($,{})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"Select Rent Month(s) *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{type:"button",variant:"outline",size:"sm",className:"h-7 text-xs",onClick:xe,disabled:!c,children:"Select All"}),e.jsx(v,{type:"button",variant:"outline",size:"sm",className:"h-7 text-xs",onClick:ue,children:"Clear"})]})]}),e.jsx("div",{className:"border rounded-lg max-h-[160px] overflow-y-auto",children:c?N.length===0?e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"No months available"}):e.jsx("div",{className:"grid grid-cols-2 gap-1 p-2",children:N.map(a=>{const y=l.includes(a.value);return e.jsxs("button",{type:"button",onClick:()=>r(a.value),className:`flex items-center gap-2 p-2 rounded-lg border transition-all text-left text-sm ${y?"border-primary bg-primary/10 text-primary":"border-transparent hover:border-muted-foreground/20 hover:bg-muted/50"}`,children:[e.jsx("span",{className:`h-4 w-4 rounded-full border flex items-center justify-center flex-shrink-0 ${y?"bg-primary border-primary":"border-muted-foreground/30"}`,children:y&&e.jsx("span",{className:"text-white text-xs",children:"✓"})}),e.jsx("span",{className:"font-medium truncate",children:a.label})]},a.value)})}):e.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"Select a lease first"})}),p>0&&e.jsxs("div",{className:"text-sm text-muted-foreground text-center",children:[p," month(s) selected"]})]}),p>0&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Payment Calculation"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Monthly Rent × ",p]}),e.jsx("span",{className:"tabular-nums",children:H(w)})]}),h>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Outstanding Due"}),e.jsxs("span",{className:"tabular-nums text-amber-600",children:["+ ",H(h)]})]}),e.jsx(oe,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Total Amount"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg tabular-nums text-primary",children:H(D)}),e.jsx(v,{type:"button",variant:"secondary",size:"sm",onClick:G,className:"text-xs",children:"Use Amount"})]})]})]}),e.jsx(R,{control:x.control,name:"amount",render:({field:a})=>e.jsxs(E,{children:[e.jsx(I,{children:"Payment Amount (BDT) *"}),e.jsx(q,{children:e.jsx(F,{...a,type:"number",step:"0.01",placeholder:"Enter amount",className:"text-lg font-semibold","data-testid":"input-payment-amount"})}),e.jsx($,{})]})}),e.jsx(R,{control:x.control,name:"paymentDate",render:({field:a})=>e.jsxs(E,{children:[e.jsx(I,{children:"Payment Date *"}),e.jsx(q,{children:e.jsx(F,{...a,type:"date","data-testid":"input-payment-date"})}),e.jsx($,{})]})}),e.jsx(R,{control:x.control,name:"receiptNumber",render:({field:a})=>e.jsxs(E,{children:[e.jsx(I,{children:"Receipt Number"}),e.jsx(q,{children:e.jsx(F,{...a,placeholder:"Optional receipt reference","data-testid":"input-payment-receipt"})}),e.jsx($,{})]})}),e.jsx(R,{control:x.control,name:"notes",render:({field:a})=>e.jsxs(E,{children:[e.jsx(I,{children:"Notes"}),e.jsx(q,{children:e.jsx(F,{...a,placeholder:"Optional notes","data-testid":"input-payment-notes"})}),e.jsx($,{})]})}),e.jsx("div",{className:"flex justify-end gap-2 pt-4",children:e.jsx(v,{type:"submit",disabled:Y.isPending,"data-testid":"button-submit-payment",children:Y.isPending?"Recording...":"Record Payment"})})]})})]})]})}function ze({tenantId:i,initialNotes:g}){const{toast:s}=U(),[b,n]=j.useState(g),[u,l]=j.useState(!1);j.useEffect(()=>{n(g),l(!1)},[g]);const t=o=>{n(o),l(o!==g)},m=B({mutationFn:async()=>O("PATCH",`/api/tenants/${i}`,{notes:b}),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/tenants",i.toString()]}),l(!1),s({title:"Notes saved successfully"})},onError:o=>{s({title:"Error saving notes",description:o.message,variant:"destructive"})}});return e.jsxs(P,{children:[e.jsx(k,{className:"pb-2",children:e.jsxs(M,{className:"text-base flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Notes"]})}),e.jsxs(T,{className:"space-y-3",children:[e.jsx(se,{value:b,onChange:o=>t(o.target.value),placeholder:"Add notes about this tenant...",rows:4,className:"resize-none text-sm"}),u&&e.jsxs(v,{size:"sm",onClick:()=>m.mutate(),disabled:m.isPending,className:"w-full",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),m.isPending?"Saving...":"Save Notes"]})]})]})}function Be({tenantId:i,ownerId:g}){const{toast:s}=U(),[b,n]=j.useState(!1),[u,l]=j.useState("advance_adjustment"),[t,m]=j.useState(""),[o,f]=j.useState(""),[S,c]=j.useState(new Date().toISOString().split("T")[0]),[N,d]=j.useState(""),{data:h,isLoading:p}=de({queryKey:["/api/tenants",i,"additional-payments"],queryFn:async()=>{const r=await fetch(`/api/tenants/${i}/additional-payments`,{credentials:"include"});if(!r.ok)throw new Error("Failed to fetch");return r.json()},enabled:!!i}),w=B({mutationFn:async()=>O("POST","/api/additional-payments",{tenantId:i,ownerId:g,paymentType:u,description:t,amount:o,paymentDate:S,notes:N}),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/tenants",i,"additional-payments"]}),s({title:"Payment added successfully"}),n(!1),m(""),f(""),c(new Date().toISOString().split("T")[0]),d("")},onError:r=>{s({title:"Error",description:r.message,variant:"destructive"})}}),D=B({mutationFn:async r=>O("DELETE",`/api/additional-payments/${r}`),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/tenants",i,"additional-payments"]}),s({title:"Payment deleted"})},onError:r=>{s({title:"Error",description:r.message,variant:"destructive"})}}),x=r=>J(parseFloat(r.toString())||0),G=r=>{switch(r){case"advance_adjustment":return"Advance Adjustment";case"service_charge":return"Service Charge";default:return"Other"}};return e.jsxs(P,{children:[e.jsx(k,{className:"pb-2",children:e.jsxs(M,{className:"text-base flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Additional Payments"]}),e.jsxs(Z,{open:b,onOpenChange:n,children:[e.jsx(me,{asChild:!0,children:e.jsxs(v,{size:"sm",variant:"outline",className:"h-7 text-xs",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"})," Add"]})}),e.jsxs(ee,{className:"sm:max-w-md",children:[e.jsx(Q,{children:e.jsx(_,{children:"Add Additional Payment"})}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Payment Type *"}),e.jsxs("select",{value:u,onChange:r=>l(r.target.value),className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm",children:[e.jsx("option",{value:"advance_adjustment",children:"Advance Adjustment"}),e.jsx("option",{value:"service_charge",children:"Service Charge"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Description *"}),e.jsx(F,{value:t,onChange:r=>m(r.target.value),placeholder:"e.g., Advance payment for shop maintenance"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Amount *"}),e.jsx(F,{type:"number",value:o,onChange:r=>f(r.target.value),placeholder:"Enter amount"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Date *"}),e.jsx(F,{type:"date",value:S,onChange:r=>c(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Notes"}),e.jsx(se,{value:N,onChange:r=>d(r.target.value),placeholder:"Optional notes",rows:2})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(v,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(v,{onClick:()=>w.mutate(),disabled:!t||!o||w.isPending,children:w.isPending?"Adding...":"Add Payment"})]})]})]})]})]})}),e.jsxs(T,{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"These payments appear only in Financial Statement reports."}),p?e.jsx(z,{className:"h-16"}):h&&h.length>0?e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:h.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded bg-muted/30 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.description}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[G(r.paymentType)," • ",new Date(r.paymentDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-green-600",children:x(r.amount)}),e.jsx(v,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-red-500 hover:text-red-700",onClick:()=>D.mutate(r.id),children:"×"})]})]},r.id))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No additional payments"})]})]})}function _e(){var u,l;const[,i]=ge("/tenants/:id"),g=i==null?void 0:i.id;X();const{data:s,isLoading:b}=de({queryKey:["/api/tenants",g],enabled:!!g}),n=t=>{const m=typeof t=="string"?parseFloat(t)||0:t;return J(m)};return b?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(z,{className:"h-9 w-9"}),e.jsx(z,{className:"h-8 w-60"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(z,{className:"h-96"}),e.jsx(z,{className:"h-96 lg:col-span-2"})]})]}):s?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(W,{href:"/tenants",children:e.jsx(v,{variant:"ghost",size:"icon","data-testid":"button-back-tenants",children:e.jsx(ce,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(fe,{className:"h-12 w-12",children:[e.jsx(Ne,{src:s.photoUrl||void 0,alt:s.name}),e.jsx(ye,{className:"bg-primary/10 text-primary text-lg",children:s.name.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2)})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:s.name}),e.jsx("p",{className:"text-muted-foreground",children:s.phone})]})]})]}),e.jsx($e,{tenant:s,leases:s.leases,onSuccess:()=>{}})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsx(k,{children:e.jsx(M,{className:"text-base",children:"Contact Information"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:s.email})]}),s.permanentAddress&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsx("span",{className:"text-sm",children:s.permanentAddress})]}),s.nidPassport&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-mono text-sm",children:s.nidPassport})]})]})]}),e.jsxs(P,{className:"border-2 border-primary/20",children:[e.jsx(k,{children:e.jsxs(M,{className:"text-base flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Financial Summary"]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Opening Balance"}),e.jsx("span",{className:"font-medium tabular-nums",children:n(s.openingDueBalance)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Rent Generated"}),e.jsx("span",{className:"font-medium tabular-nums",children:n(s.totalDue-parseFloat(s.openingDueBalance))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Paid"}),e.jsxs("span",{className:"font-medium text-emerald-600 dark:text-emerald-400 tabular-nums",children:["-",n(s.totalPaid)]})]}),e.jsx(oe,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Current Outstanding"}),e.jsx("span",{className:`text-xl font-bold tabular-nums ${s.currentDue>0?"text-destructive":"text-emerald-600 dark:text-emerald-400"}`,children:n(s.currentDue)})]})]})]}),(()=>{const t=s.monthlyDues||{},m=Object.entries(t).sort(([c],[N])=>{const[d,h]=c.split("-").map(Number),[p,w]=N.split("-").map(Number);return d!==p?d-p:h-w});if(m.length===0)return null;const o=parseFloat(s.openingDueBalance||"0");let f=s.totalPaid;f-=o,f<0&&(f=0);const S=m.map(([c,N])=>{const[d,h]=c.split("-").map(Number),p=N,w=new Date(d,h-1).toLocaleString("default",{month:"short",year:"numeric"});let D="unpaid",x=0;return f>=p?(D="paid",x=p,f-=p):f>0&&(D="partial",x=f,f=0),{monthKey:c,monthName:w,amount:p,status:D,paidAmount:x,dueAmount:p-x}});return e.jsxs(P,{children:[e.jsx(k,{children:e.jsxs(M,{className:"text-base flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Monthly Dues (FIFO)"]})}),e.jsxs(T,{children:[o>0&&e.jsxs("div",{className:"mb-3 p-2 rounded bg-muted/50 flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Opening Balance"}),e.jsx(L,{variant:s.totalPaid>=o?"default":"destructive",className:s.totalPaid>=o?"bg-emerald-500":"",children:s.totalPaid>=o?"Paid":n(o)})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:S.map(({monthKey:c,monthName:N,amount:d,status:h,paidAmount:p,dueAmount:w})=>e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:N}),e.jsx("span",{className:"text-xs text-muted-foreground",children:n(d)})]}),h==="paid"&&e.jsx(L,{className:"bg-emerald-500 text-white",children:"Paid"}),h==="partial"&&e.jsxs(L,{variant:"outline",className:"text-amber-600 border-amber-400",children:["Due: ",n(w)]}),h==="unpaid"&&e.jsxs(L,{variant:"destructive",children:["Due: ",n(w)]})]},c))})]})]})})(),e.jsxs(P,{children:[e.jsx(k,{children:e.jsxs(M,{className:"text-base flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Active Leases"]})}),e.jsx(T,{children:s.leases&&s.leases.length>0?e.jsx("div",{className:"space-y-3",children:s.leases.map(t=>e.jsx(W,{href:`/leases/${t.id}`,children:e.jsxs("div",{className:"p-3 rounded-md bg-muted/50 hover-elevate cursor-pointer transition-all duration-200 hover:bg-muted/80 hover:shadow-md","data-testid":`lease-card-${t.id}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-medium text-primary hover:underline",children:["Shop ",t.shop.shopNumber]}),e.jsx(L,{className:be(t.status),variant:"secondary",children:t.status.replace("_"," ")})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("span",{children:we(t.shop.floor)}),e.jsx("span",{className:"mx-2",children:"|"}),e.jsxs("span",{children:[n(parseFloat(t.monthlyRent)),"/month"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1 flex items-center gap-1",children:[e.jsx(ne,{className:"h-3 w-3"}),new Date(t.startDate).toLocaleDateString()," - ",new Date(t.endDate).toLocaleDateString()]}),(t.status==="active"||t.status==="expiring_soon"||t.status==="expired")&&e.jsx("div",{className:"mt-3 pt-3 border-t flex justify-end",onClick:m=>m.preventDefault(),children:e.jsx(qe,{lease:t,tenant:s,onSuccess:()=>{}})})]})},t.id))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No active leases"})})]}),e.jsx(ze,{tenantId:s.id,initialNotes:s.notes||""}),s.leases&&s.leases.length>0&&s.leases[0].shop&&e.jsx(Be,{tenantId:s.id,ownerId:((u=s.leases[0].shop)==null?void 0:u.ownerId)||1})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(P,{children:[e.jsxs(k,{className:"flex flex-row items-center justify-between gap-2",children:[e.jsxs(M,{className:"text-base flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Tenant Ledger"]}),e.jsxs(L,{variant:"outline",children:[((l=s.ledgerEntries)==null?void 0:l.length)??0," entries"]})]}),e.jsx(T,{children:s.ledgerEntries&&s.ledgerEntries.length>0?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs font-medium text-muted-foreground uppercase tracking-wider py-2 border-b",children:[e.jsx("div",{className:"col-span-2",children:"Date"}),e.jsx("div",{className:"col-span-5",children:"Description"}),e.jsx("div",{className:"col-span-2 text-right",children:"Debit"}),e.jsx("div",{className:"col-span-2 text-right",children:"Credit"}),e.jsx("div",{className:"col-span-1 text-right",children:"Balance"})]}),s.ledgerEntries.map(t=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 py-3 border-b border-dashed last:border-0 items-center text-sm","data-testid":`ledger-entry-${t.id}`,children:[e.jsx("div",{className:"col-span-2 text-muted-foreground",children:new Date(t.date).toLocaleDateString()}),e.jsxs("div",{className:"col-span-5 flex items-center gap-2",children:[t.type==="rent"&&e.jsx(Te,{className:"h-4 w-4 text-amber-500"}),t.type==="payment"&&e.jsx(Me,{className:"h-4 w-4 text-emerald-500"}),t.type==="opening"&&e.jsx(ae,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"truncate",children:t.description})]}),e.jsx("div",{className:"col-span-2 text-right tabular-nums",children:t.debit>0?e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:n(t.debit)}):"-"}),e.jsx("div",{className:"col-span-2 text-right tabular-nums",children:t.credit>0?e.jsx("span",{className:"text-emerald-600 dark:text-emerald-400",children:n(t.credit)}):"-"}),e.jsx("div",{className:"col-span-1 text-right font-medium tabular-nums",children:n(t.balance)})]},t.id))]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(re,{className:"h-12 w-12 text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No ledger entries yet"})]})})]})})]})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Tenant not found"}),e.jsx(W,{href:"/tenants",children:e.jsxs(v,{variant:"outline",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Back to Tenants"]})})]})})}export{_e as default};
