const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-DVQgvFRt.js","assets/index-CAzW3HqC.js","assets/index-CvfNsG2m.css"])))=>i.map(i=>d[i]);
import{j as e,aX as b,r as c,b2 as De,a4 as Ce,o as Re,u as we,e as A,X as ne,m as J,C as v,f as le,i as re,a6 as Te,a as S,U as Fe,a8 as C,a9 as R,aa as w,ab as T,ac as f,B as ie,al as Me,h as ce,l as K,aJ as Oe,b as _e,aM as ke,k as oe,S as Le,Y as Ae,Z as Ye,_ as de,$ as g,a0 as $e,a1 as u,L as ze,n as Ie,af as me,b3 as x}from"./index-CAzW3HqC.js";import{C as Ve,D as Ee}from"./date-filter-Ej3Z7fih.js";import{D as qe}from"./download-DuG1lpK0.js";import{D as Be}from"./dollar-sign-CxgbUACI.js";import{P as He}from"./phone-BklwAKgw.js";import{f as xe}from"./format-BEMO4FpZ.js";const he=({className:o,...i})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:b("mx-auto flex w-full justify-center",o),...i});he.displayName="Pagination";const ge=c.forwardRef(({className:o,...i},m)=>e.jsx("ul",{ref:m,className:b("flex flex-row items-center gap-1",o),...i}));ge.displayName="PaginationContent";const Y=c.forwardRef(({className:o,...i},m)=>e.jsx("li",{ref:m,className:b("",o),...i}));Y.displayName="PaginationItem";const $=({className:o,isActive:i,size:m="icon",...M})=>e.jsx("a",{"aria-current":i?"page":void 0,className:b(De({variant:i?"outline":"ghost",size:m}),o),...M});$.displayName="PaginationLink";const ue=({className:o,...i})=>e.jsxs($,{"aria-label":"Go to previous page",size:"default",className:b("gap-1 pl-2.5",o),...i,children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});ue.displayName="PaginationPrevious";const je=({className:o,...i})=>e.jsxs($,{"aria-label":"Go to next page",size:"default",className:b("gap-1 pr-2.5",o),...i,children:[e.jsx("span",{children:"Next"}),e.jsx(Ce,{className:"h-4 w-4"})]});je.displayName="PaginationNext";const F=["January","February","March","April","May","June","July","August","September","October","November","December"];function Qe(){var ee,te,ae;const{toast:o}=Re();we();const i=new Date,[m,M]=c.useState("all"),[O,W]=c.useState("all"),[_,G]=c.useState("all"),[z,U]=c.useState((i.getMonth()+1).toString()),[I,X]=c.useState(i.getFullYear().toString()),[P,V]=c.useState(),[D,E]=c.useState(),[j,h]=c.useState(1),[Q]=c.useState(20),p=t=>Ie(t),pe=()=>{V(void 0),E(void 0)},{data:q}=A({queryKey:["/api/owners"]}),{data:k}=A({queryKey:["/api/tenants"]}),{data:L}=A({queryKey:["/api/shops"]}),fe=c.useMemo(()=>{const t=new URLSearchParams;return m!=="all"&&t.append("ownerId",m),O!=="all"&&t.append("tenantId",O),_!=="all"&&t.append("shopId",_),t.append("month",z),t.append("year",I),P&&t.append("startDate",xe(P,"yyyy-MM-dd")),D&&t.append("endDate",xe(D,"yyyy-MM-dd")),t.append("page",j.toString()),t.append("limit",Q.toString()),t.toString()},[m,O,_,z,I,P,D,j,Q]),{data:a,isLoading:Ne}=A({queryKey:[`/api/reports/owner-tenant-details?${fe}`]}),ye=c.useMemo(()=>L?m==="all"?L:L.filter(t=>t.ownerId===parseInt(m)):[],[L,m]),B=c.useMemo(()=>k||k||[],[k]),ve=c.useMemo(()=>{const l=i.getFullYear()+1;return Array.from({length:l-2020+1},(s,d)=>2020+d)},[]),Se=async()=>{if(!(a!=null&&a.allData)||a.allData.length===0){o({title:"No data to export",variant:"destructive"});return}const{default:t}=await me(async()=>{const{default:r}=await import("./jspdf.es.min-DVQgvFRt.js").then(N=>N.j);return{default:r}},__vite__mapDeps([0,1,2])),{default:l}=await me(async()=>{const{default:r}=await import("./jspdf.plugin.autotable-CfO62xhj.js");return{default:r}},[]),s=new t({orientation:"landscape",unit:"mm",format:"a4"}),d=s.internal.pageSize.getWidth(),n=s.internal.pageSize.getHeight();s.setFontSize(16),s.setFont("helvetica","bold"),s.text("Owner Tenant Details Report",d/2,15,{align:"center"}),s.setFontSize(10),s.setFont("helvetica","normal"),s.text(`Owner: ${a.filters.ownerName}`,14,25),s.text(`Period: ${F[a.filters.month-1]} ${a.filters.year}`,14,30),s.text(`Report Date: ${new Date(a.reportDate).toLocaleDateString()}`,d-14,25,{align:"right"}),s.text(`Total Records: ${a.allData.length}`,d-14,30,{align:"right"});const y=a.allData.map((r,N)=>[(N+1).toString(),r.shopLocation,r.tenantName,r.phone,x(r.monthlyRent||0),r.recentPaymentAmount>0?x(r.recentPaymentAmount):"-",r.recentPaymentDate||"-",x(r.currentOutstanding||0)]),H=a.allData.reduce((r,N)=>({monthlyRent:r.monthlyRent+(N.monthlyRent||0),recentPayment:r.recentPayment+(N.recentPaymentAmount||0),currentOutstanding:r.currentOutstanding+(N.currentOutstanding||0)}),{monthlyRent:0,recentPayment:0,currentOutstanding:0});l(s,{startY:38,head:[["SL","Shop Location","Tenant Name","Phone","Monthly Rent","Recent Payment","Payment Date","Current Due"]],body:y,foot:[["","TOTAL",`${a.allData.length} Tenants`,"",x(H.monthlyRent),x(H.recentPayment),"",x(H.currentOutstanding)]],theme:"grid",headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold",halign:"center",fontSize:8},bodyStyles:{fontSize:7,cellPadding:1.5},footStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold",fontSize:8},columnStyles:{0:{halign:"center",cellWidth:10},1:{cellWidth:38},2:{cellWidth:38},3:{cellWidth:28},4:{halign:"right",cellWidth:28},5:{halign:"right",cellWidth:28},6:{halign:"center",cellWidth:25},7:{halign:"right",cellWidth:30}},margin:{top:38,left:14,right:14,bottom:25},didDrawPage:r=>{s.setFontSize(8),s.text(`Page ${r.pageNumber}`,d/2,n-10,{align:"center"})}});const se=s.lastAutoTable.finalY||150;se>n-60?(s.addPage(),Z(s,20,d,a)):Z(s,se+8,d,a);const Pe=`Owner_Tenant_Report_${a.filters.ownerName.replace(/\s+/g,"_")}_${F[a.filters.month-1]}_${a.filters.year}.pdf`;s.save(Pe),o({title:"PDF exported successfully"})},Z=(t,l,s,d)=>{t.setDrawColor(0),t.setLineWidth(.5),t.line(14,l,s-14,l);let n=l+8;t.setFontSize(11),t.setFont("helvetica","bold"),t.text("Rent Collection by Location",14,n),t.text(`Period: ${F[d.filters.month-1]} ${d.filters.year}`,s-14,n,{align:"right"}),n+=8,t.setFontSize(10),t.setFont("helvetica","normal");const y=d.locationTotals||{ground:0,first:0,second:0,subedari:0};t.text("Ground Floor:",14,n),t.text(x(y.ground||0),70,n,{align:"right"}),t.text("1st Floor:",s/2,n),t.text(x(y.first||0),s/2+56,n,{align:"right"}),n+=6,t.text("2nd Floor:",14,n),t.text(x(y.second||0),70,n,{align:"right"}),t.text("Subedari:",s/2,n),t.text(x(y.subedari||0),s/2+56,n,{align:"right"}),n+=8,t.setFont("helvetica","bold"),t.text("Total Collection:",14,n),t.text(x(d.totals.totalRecentPayments||0),70,n,{align:"right"}),t.text("Total Outstanding:",s/2,n),t.text(x(d.totals.totalCurrentOutstanding||0),s/2+56,n,{align:"right"})},be=()=>{M("all"),W("all"),G("all"),U((i.getMonth()+1).toString()),X(i.getFullYear().toString()),V(void 0),E(void 0),h(1)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-semibold flex items-center gap-3",children:[e.jsx(ne,{className:"h-6 w-6"}),"Owner Tenant Details Report"]}),e.jsx("p",{className:"text-muted-foreground",children:"Comprehensive report of all tenants with rent dues and payment history"})]}),e.jsxs(J,{onClick:Se,disabled:!((ee=a==null?void 0:a.allData)!=null&&ee.length),className:"whitespace-nowrap",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Export PDF"]})]}),e.jsxs(v,{children:[e.jsx(le,{className:"pb-3",children:e.jsxs(re,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4"}),"Filters"]})}),e.jsxs(S,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(Fe,{className:"h-3 w-3"}),"Owner"]}),e.jsxs(C,{value:m,onValueChange:t=>{M(t),h(1)},children:[e.jsx(R,{children:e.jsx(w,{placeholder:"Select Owner"})}),e.jsxs(T,{children:[e.jsx(f,{value:"all",children:"All Owners"}),q==null?void 0:q.map(t=>e.jsx(f,{value:t.id.toString(),children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(ie,{className:"h-3 w-3"}),"Shop"]}),e.jsxs(C,{value:_,onValueChange:t=>{G(t),h(1)},children:[e.jsx(R,{children:e.jsx(w,{placeholder:"Select Shop"})}),e.jsxs(T,{children:[e.jsx(f,{value:"all",children:"All Shops"}),ye.map(t=>e.jsxs(f,{value:t.id.toString(),children:[Me(t.floor,t.subedariCategory)," - ",t.shopNumber]},t.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),"Tenant"]}),e.jsxs(C,{value:O,onValueChange:t=>{W(t),h(1)},children:[e.jsx(R,{children:e.jsx(w,{placeholder:"Select Tenant"})}),e.jsxs(T,{children:[e.jsx(f,{value:"all",children:"All Tenants"}),B==null?void 0:B.map(t=>e.jsx(f,{value:t.id.toString(),children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),"Month"]}),e.jsxs(C,{value:z,onValueChange:t=>{U(t),h(1)},children:[e.jsx(R,{children:e.jsx(w,{placeholder:"Select Month"})}),e.jsx(T,{children:F.map((t,l)=>e.jsx(f,{value:(l+1).toString(),children:t},l))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),"Year"]}),e.jsxs(C,{value:I,onValueChange:t=>{X(t),h(1)},children:[e.jsx(R,{children:e.jsx(w,{placeholder:"Select Year"})}),e.jsx(T,{children:ve.map(t=>e.jsx(f,{value:t.toString(),children:t},t))})]})]}),e.jsx("div",{className:"space-y-2 flex items-end",children:e.jsx(J,{variant:"outline",onClick:be,className:"w-full",children:"Reset Filters"})})]}),e.jsx(Oe,{className:"my-4"}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Date Range Filter"]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(Ee,{startDate:P,endDate:D,onStartDateChange:t=>{V(t),h(1)},onEndDateChange:t=>{E(t),h(1)},className:"flex-1"}),(P||D)&&e.jsx(J,{variant:"ghost",size:"sm",onClick:pe,children:"Clear"})]})]})]})]}),a&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(v,{children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(_e,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Month Due"}),e.jsx("p",{className:"text-xl font-semibold text-red-600",children:p(a.totals.totalCurrentRentDue)})]})]})})}),e.jsx(v,{children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(Be,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Previous Dues"}),e.jsx("p",{className:"text-xl font-semibold text-orange-600",children:p(a.totals.totalPreviousRentDue)})]})]})})}),e.jsx(v,{children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(ke,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Period Received"}),e.jsx("p",{className:"text-xl font-semibold text-green-600",children:p(a.totals.totalRecentPayments)})]})]})})}),e.jsx(v,{children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(ie,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Monthly Rent"}),e.jsx("p",{className:"text-xl font-semibold text-blue-600",children:p(a.totals.totalMonthlyRent)})]})]})})})]}),e.jsxs(v,{children:[e.jsx(le,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(re,{className:"text-base",children:["Tenant Details",a&&e.jsxs(oe,{variant:"secondary",className:"ml-2",children:[a.pagination.totalRecords," records"]})]}),a&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.filters.ownerName," - ",F[a.filters.month-1]," ",a.filters.year]})]})}),e.jsx(S,{children:Ne?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((t,l)=>e.jsx(Le,{className:"h-12 w-full"},l))}):((te=a==null?void 0:a.data)==null?void 0:te.length)===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx(ne,{className:"h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{className:"font-medium",children:"No data found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(Ae,{children:[e.jsx(Ye,{children:e.jsxs(de,{className:"bg-muted/50",children:[e.jsx(g,{className:"w-12 text-center",children:"SL"}),e.jsx(g,{children:"Shop Location"}),e.jsx(g,{children:"Tenant Name"}),e.jsx(g,{children:"Phone"}),e.jsx(g,{className:"text-right",children:"Monthly Rent"}),e.jsx(g,{className:"text-right",children:"Recent Payment"}),e.jsx(g,{className:"text-center",children:"Payment Date"}),e.jsx(g,{className:"text-right",children:"Current Due"}),e.jsx(g,{className:"text-right",children:"Previous Due"})]})}),e.jsx($e,{children:(ae=a==null?void 0:a.data)==null?void 0:ae.map((t,l)=>e.jsxs(de,{children:[e.jsx(u,{className:"text-center font-medium",children:(a.pagination.page-1)*a.pagination.limit+l+1}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}),t.shopLocation]})}),e.jsx(u,{className:"font-medium",children:e.jsx(ze,{href:`/tenants/${t.tenantId}`,className:"hover:underline hover:text-primary",children:t.tenantName})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(He,{className:"h-3 w-3"}),t.phone]})}),e.jsx(u,{className:"text-right",children:p(t.monthlyRent)}),e.jsx(u,{className:"text-right",children:t.recentPaymentAmount>0?e.jsx("span",{className:"text-green-600",children:p(t.recentPaymentAmount)}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(u,{className:"text-center",children:t.recentPaymentDate||e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(u,{className:"text-right",children:t.currentRentDue>0?e.jsx("span",{className:"text-red-600 font-medium",children:p(t.currentRentDue)}):e.jsx(oe,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Paid"})}),e.jsx(u,{className:"text-right",children:t.previousRentDue>0?e.jsx("span",{className:"text-orange-600 font-medium",children:p(t.previousRentDue)}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})]},t.leaseId))})]})}),a&&a.pagination.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",(a.pagination.page-1)*a.pagination.limit+1," to"," ",Math.min(a.pagination.page*a.pagination.limit,a.pagination.totalRecords)," of"," ",a.pagination.totalRecords," entries"]}),e.jsx(he,{children:e.jsxs(ge,{children:[e.jsx(Y,{children:e.jsx(ue,{onClick:()=>h(t=>Math.max(1,t-1)),className:j===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,a.pagination.totalPages)},(t,l)=>{let s;return a.pagination.totalPages<=5||j<=3?s=l+1:j>=a.pagination.totalPages-2?s=a.pagination.totalPages-4+l:s=j-2+l,e.jsx(Y,{children:e.jsx($,{onClick:()=>h(s),isActive:j===s,className:"cursor-pointer",children:s})},s)}),e.jsx(Y,{children:e.jsx(je,{onClick:()=>h(t=>Math.min(a.pagination.totalPages,t+1)),className:j===a.pagination.totalPages?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})]})})]})]})}export{Qe as default};
