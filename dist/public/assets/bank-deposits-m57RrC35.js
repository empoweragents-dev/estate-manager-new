import{r as D,o as V,u as X,e as $,x as H,j as e,S as b,C as B,a as R,D as Y,p as Z,m as S,P as q,q as _,s as ee,t as se,aN as E,Y as te,Z as ae,_ as P,$ as o,a0 as ne,a1 as d,l as re,ao as ie,ap as le,aq as oe,k as L,ar as de,as as ce,ax as xe,B as me,X as ue,an as he,ay as je,az as pe,aA as ge,aB as fe,aC as Ne,I as g,ai as De,aD as be,aE as we,aF as ve,z as c,v as ye,w as ke,F as Se,y as m,A as u,E as h,a8 as Ce,G as j,a9 as Te,aa as Ae,ab as Be,ac as Re,H as p,n as Fe,J as K,K as z}from"./index-BrpuEMYd.js";const Ie=c.object({ownerId:c.string().min(1,"Owner is required"),amount:c.string().min(1,"Amount is required"),depositDate:c.string().min(1,"Date is required"),bankName:c.string().min(1,"Bank name is required"),depositSlipRef:c.string().optional(),notes:c.string().optional()});function Oe({owners:w,onSuccess:f}){const{toast:v}=V(),n=ye({resolver:ke(Ie),defaultValues:{ownerId:"",amount:"",depositDate:new Date().toISOString().split("T")[0],bankName:"",depositSlipRef:"",notes:""}}),i=n.watch("ownerId"),r=w.find(t=>t.id.toString()===i),l=H({mutationFn:async t=>K("POST","/api/bank-deposits",{...t,ownerId:parseInt(t.ownerId)}),onSuccess:()=>{z.invalidateQueries({queryKey:["/api/bank-deposits"]}),v({title:"Bank deposit recorded successfully"}),f()},onError:t=>{v({title:"Error",description:t.message,variant:"destructive"})}}),N=t=>{l.mutate(t)};return e.jsx(Se,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(N),className:"space-y-4",children:[e.jsx(m,{control:n.control,name:"ownerId",render:({field:t})=>e.jsxs(u,{children:[e.jsx(h,{children:"Owner *"}),e.jsxs(Ce,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(j,{children:e.jsx(Te,{"data-testid":"select-deposit-owner",children:e.jsx(Ae,{placeholder:"Select owner"})})}),e.jsx(Be,{children:w.map(x=>e.jsx(Re,{value:x.id.toString(),children:x.name},x.id))})]}),e.jsx(p,{})]})}),(r==null?void 0:r.bankName)&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg text-sm",children:[e.jsx("p",{className:"font-medium",children:"Owner's Bank Account"}),e.jsxs("p",{className:"text-muted-foreground",children:[r.bankName," - ",r.bankBranch]}),r.bankAccountNumber&&e.jsx("p",{className:"font-mono text-muted-foreground",children:r.bankAccountNumber})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:n.control,name:"amount",render:({field:t})=>e.jsxs(u,{children:[e.jsx(h,{children:"Amount (BDT) *"}),e.jsx(j,{children:e.jsx(g,{...t,type:"number",step:"0.01",placeholder:"Enter amount",className:"text-lg font-semibold","data-testid":"input-deposit-amount"})}),e.jsx(p,{})]})}),e.jsx(m,{control:n.control,name:"depositDate",render:({field:t})=>e.jsxs(u,{children:[e.jsx(h,{children:"Deposit Date *"}),e.jsx(j,{children:e.jsx(g,{...t,type:"date","data-testid":"input-deposit-date"})}),e.jsx(p,{})]})})]}),e.jsx(m,{control:n.control,name:"bankName",render:({field:t})=>e.jsxs(u,{children:[e.jsx(h,{children:"Bank Name *"}),e.jsx(j,{children:e.jsx(g,{...t,placeholder:"e.g., Dutch Bangla Bank","data-testid":"input-deposit-bank"})}),e.jsx(p,{})]})}),e.jsx(m,{control:n.control,name:"depositSlipRef",render:({field:t})=>e.jsxs(u,{children:[e.jsx(h,{children:"Deposit Slip / Reference ID"}),e.jsx(j,{children:e.jsx(g,{...t,placeholder:"Deposit slip or transaction reference","data-testid":"input-deposit-ref"})}),e.jsx(p,{})]})}),e.jsx(m,{control:n.control,name:"notes",render:({field:t})=>e.jsxs(u,{children:[e.jsx(h,{children:"Notes"}),e.jsx(j,{children:e.jsx(g,{...t,placeholder:"Additional notes","data-testid":"input-deposit-notes"})}),e.jsx(p,{})]})}),e.jsx("div",{className:"flex justify-end gap-2 pt-4",children:e.jsx(S,{type:"submit",disabled:l.isPending,"data-testid":"button-save-deposit",children:l.isPending?"Recording...":"Record Deposit"})})]})})}function Ee(){var I;const[w,f]=D.useState(!1),[v,n]=D.useState(!1),[i,r]=D.useState(null),[l,N]=D.useState(""),[t,x]=D.useState(new Date().toISOString().split("T")[0]),{toast:F}=V();X();const{data:C=[],isLoading:M}=$({queryKey:["/api/bank-deposits"]}),{data:Q=[]}=$({queryKey:["/api/owners"]}),y=H({mutationFn:async({id:s,reason:a,deletionDate:A})=>K("DELETE",`/api/bank-deposits/${s}`,{reason:a,deletionDate:A}),onSuccess:()=>{z.invalidateQueries({queryKey:["/api/bank-deposits"]}),F({title:"Bank deposit deleted successfully"}),n(!1),r(null),N("")},onError:s=>{F({title:"Error",description:s.message,variant:"destructive"})}}),U=s=>{r(s),N(""),x(new Date().toISOString().split("T")[0]),n(!0)},G=()=>{i&&l.trim()&&y.mutate({id:i.id,reason:l.trim(),deletionDate:t})},J=()=>{f(!1)},T=s=>{const a=typeof s=="string"?parseFloat(s)||0:s;return Fe(a)},W=C.filter(s=>!s.isDeleted).reduce((s,a)=>s+parseFloat(a.amount),0);return M?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{className:"h-8 w-40"}),e.jsx(b,{className:"h-4 w-60 mt-2"})]}),e.jsx(b,{className:"h-9 w-32"})]}),e.jsx(b,{className:"h-24"}),e.jsx(B,{children:e.jsx(R,{className:"p-0",children:[1,2,3,4,5].map(s=>e.jsx(b,{className:"h-16 w-full"},s))})})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Bank Deposits"}),e.jsx("p",{className:"text-muted-foreground",children:"Track deposits made to owner bank accounts"})]}),e.jsxs(Y,{open:w,onOpenChange:f,children:[e.jsx(Z,{asChild:!0,children:e.jsxs(S,{"data-testid":"button-add-deposit",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Record Deposit"]})}),e.jsxs(_,{className:"sm:max-w-lg",children:[e.jsx(ee,{children:e.jsx(se,{children:"Record Bank Deposit"})}),e.jsx(Oe,{owners:Q,onSuccess:J})]})]})]}),e.jsx(B,{className:"overflow-visible",children:e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Deposited"}),e.jsx("p",{className:"text-2xl font-semibold tabular-nums text-primary",children:T(W)})]}),e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg bg-primary/10 text-primary",children:e.jsx(E,{className:"h-6 w-6"})})]})})}),e.jsx(B,{children:e.jsx(R,{className:"p-0",children:C.length>0?e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(P,{children:[e.jsx(o,{children:"Date"}),e.jsx(o,{children:"Owner"}),e.jsx(o,{children:"Bank"}),e.jsx(o,{children:"Deposit Slip/Ref"}),e.jsx(o,{className:"text-right",children:"Amount"}),e.jsx(o,{children:"Notes"}),e.jsx(o,{className:"w-[60px]"})]})}),e.jsx(ne,{children:C.map(s=>{var O;const a=s.isDeleted,A=a?"opacity-60 bg-muted/30":"",k=a?"line-through text-muted-foreground":"";return e.jsxs(P,{"data-testid":`row-deposit-${s.id}`,className:A,children:[e.jsx(d,{children:e.jsxs("div",{className:`flex items-center gap-1 text-sm ${k}`,children:[e.jsx(re,{className:`h-4 w-4 ${a?"text-muted-foreground/50":"text-muted-foreground"}`}),new Date(s.depositDate).toLocaleDateString(),a&&e.jsx(ie,{children:e.jsxs(le,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx(L,{variant:"destructive",className:"text-[10px] px-1.5 py-0",children:"Voided"}),e.jsx(de,{className:"h-3.5 w-3.5 text-muted-foreground cursor-help"})]})}),e.jsx(ce,{side:"right",className:"max-w-[300px]",children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Deleted:"})," ",s.deletedAt?new Date(s.deletedAt).toLocaleString():"Unknown"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Reason:"})," ",s.deletionReason||"No reason provided"]})]})})]})})]})}),e.jsx(d,{children:e.jsxs("div",{className:`flex items-center gap-2 ${k}`,children:[e.jsx(xe,{className:`h-4 w-4 ${a?"text-muted-foreground/50":"text-muted-foreground"}`}),(O=s.owner)==null?void 0:O.name]})}),e.jsx(d,{children:e.jsxs("div",{className:`flex items-center gap-2 ${k}`,children:[e.jsx(me,{className:`h-4 w-4 ${a?"text-muted-foreground/50":"text-muted-foreground"}`}),s.bankName]})}),e.jsx(d,{children:s.depositSlipRef?e.jsxs("div",{className:`flex items-center gap-1 text-sm ${k}`,children:[e.jsx(ue,{className:`h-3 w-3 ${a?"text-muted-foreground/50":"text-muted-foreground"}`}),e.jsx("span",{className:"font-mono",children:s.depositSlipRef})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(d,{className:"text-right",children:e.jsx(L,{className:a?"bg-gray-100 text-gray-500 dark:bg-gray-800/30 dark:text-gray-500 tabular-nums line-through":"bg-primary/10 text-primary tabular-nums",children:T(s.amount)})}),e.jsx(d,{children:e.jsx("span",{className:`text-sm truncate max-w-[150px] block ${a?"text-muted-foreground/50":"text-muted-foreground"}`,children:s.notes||"-"})}),e.jsx(d,{children:!a&&e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>U(s),disabled:y.isPending,"data-testid":`button-delete-deposit-${s.id}`,children:e.jsx(he,{className:"h-4 w-4 text-destructive"})})})]},s.id)})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(E,{className:"h-12 w-12 text-muted-foreground/50 mb-4"}),e.jsx("h3",{className:"font-semibold mb-1",children:"No deposits recorded"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Track deposits made to owner bank accounts"}),e.jsxs(S,{onClick:()=>f(!0),"data-testid":"button-add-first-deposit",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Record Deposit"]})]})})}),e.jsx(je,{open:v,onOpenChange:n,children:e.jsxs(pe,{children:[e.jsxs(ge,{children:[e.jsx(fe,{children:"Delete Bank Deposit Record"}),e.jsx(Ne,{children:i&&e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsx("p",{children:"Are you sure you want to delete this bank deposit?"}),e.jsxs("div",{className:"bg-muted p-3 rounded-md text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Owner:"})," ",(I=i.owner)==null?void 0:I.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," ",T(i.amount)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(i.depositDate).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Bank:"})," ",i.bankName]})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Deletion Date"}),e.jsx(g,{type:"date",value:t,onChange:s=>x(s.target.value),className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Reason for deletion ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(De,{value:l,onChange:s=>N(s.target.value),placeholder:"Please provide a reason for deleting this bank deposit record...",className:"min-h-[80px]"})]})]}),e.jsxs(be,{children:[e.jsx(we,{onClick:()=>n(!1),children:"Cancel"}),e.jsx(ve,{onClick:G,disabled:!l.trim()||y.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:y.isPending?"Deleting...":"Delete Deposit"})]})]})})]})}export{Ee as default};
