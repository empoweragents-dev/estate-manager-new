import{c as P,r as x,o as G,u as ne,e as B,x as W,j as e,S as b,C as E,a as k,D as re,p as ce,m as M,P as Y,q as ie,s as oe,t as de,a5 as I,U as Q,a6 as xe,a7 as me,a8 as S,a9 as C,aa as D,ab as T,ac as l,I as w,Y as he,Z as ue,_ as Z,$ as u,a0 as je,a1 as j,k as V,l as pe,ax as ge,an as fe,z as m,aP as ve,v as Ne,w as ye,F as be,y as p,A as g,E as f,G as v,H as N,am as we,n as Se,J as X,K as _}from"./index-BrpuEMYd.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=P("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=P("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=P("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Fe=m.object({expenseType:m.enum(["guard","cleaner","electricity","maintenance","other"]),description:m.string().min(1,"Description is required"),amount:m.string().min(1,"Amount is required"),expenseDate:m.string().min(1,"Date is required"),allocation:m.enum(["owner","common"]),ownerId:m.string().optional(),receiptRef:m.string().optional()}),Ee={guard:ve,cleaner:Ce,electricity:Te,maintenance:De,other:I},ke={guard:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",cleaner:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",electricity:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400",maintenance:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",other:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"};function Me({owners:y,onSuccess:o}){const{toast:n}=G(),t=Ne({resolver:ye(Fe),defaultValues:{expenseType:"guard",description:"",amount:"",expenseDate:new Date().toISOString().split("T")[0],allocation:"common",ownerId:"",receiptRef:""}}),c=t.watch("allocation"),d=W({mutationFn:async a=>X("POST","/api/expenses",{...a,ownerId:a.allocation==="owner"&&a.ownerId?parseInt(a.ownerId):null}),onSuccess:()=>{_.invalidateQueries({queryKey:["/api/expenses"]}),n({title:"Expense recorded successfully"}),o()},onError:a=>{n({title:"Error",description:a.message,variant:"destructive"})}}),h=a=>{d.mutate(a)};return e.jsx(be,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(h),className:"space-y-4",children:[e.jsx(p,{control:t.control,name:"expenseType",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Expense Type *"}),e.jsxs(S,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(v,{children:e.jsx(C,{"data-testid":"select-expense-type",children:e.jsx(D,{placeholder:"Select type"})})}),e.jsxs(T,{children:[e.jsx(l,{value:"guard",children:"Guard"}),e.jsx(l,{value:"cleaner",children:"Cleaner"}),e.jsx(l,{value:"electricity",children:"Electricity"}),e.jsx(l,{value:"maintenance",children:"Maintenance"}),e.jsx(l,{value:"other",children:"Other"})]})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"description",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Description *"}),e.jsx(v,{children:e.jsx(w,{...a,placeholder:"Describe the expense","data-testid":"input-expense-description"})}),e.jsx(N,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{control:t.control,name:"amount",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Amount (BDT) *"}),e.jsx(v,{children:e.jsx(w,{...a,type:"number",step:"0.01",placeholder:"Enter amount","data-testid":"input-expense-amount"})}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"expenseDate",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Date *"}),e.jsx(v,{children:e.jsx(w,{...a,type:"date","data-testid":"input-expense-date"})}),e.jsx(N,{})]})})]}),e.jsx(p,{control:t.control,name:"allocation",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Allocation *"}),e.jsxs(S,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(v,{children:e.jsx(C,{"data-testid":"select-expense-allocation",children:e.jsx(D,{placeholder:"Select allocation"})})}),e.jsxs(T,{children:[e.jsx(l,{value:"common",children:"Common (Shared by all owners)"}),e.jsx(l,{value:"owner",children:"Specific Owner"})]})]}),e.jsx(we,{children:a.value==="common"?"This expense will be deducted from common revenue (split equally)":"This expense will be charged to a specific owner"}),e.jsx(N,{})]})}),c==="owner"&&e.jsx(p,{control:t.control,name:"ownerId",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Owner *"}),e.jsxs(S,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(v,{children:e.jsx(C,{"data-testid":"select-expense-owner",children:e.jsx(D,{placeholder:"Select owner"})})}),e.jsx(T,{children:y.map(i=>e.jsx(l,{value:i.id.toString(),children:i.name},i.id))})]}),e.jsx(N,{})]})}),e.jsx(p,{control:t.control,name:"receiptRef",render:({field:a})=>e.jsxs(g,{children:[e.jsx(f,{children:"Receipt Reference"}),e.jsx(v,{children:e.jsx(w,{...a,placeholder:"Optional receipt/invoice number","data-testid":"input-expense-receipt"})}),e.jsx(N,{})]})}),e.jsx("div",{className:"flex justify-end gap-2 pt-4",children:e.jsx(M,{type:"submit",disabled:d.isPending,"data-testid":"button-save-expense",children:d.isPending?"Recording...":"Record Expense"})})]})})}const Ae=["guard","cleaner","electricity","maintenance","other"];function Ie(){const y=[],o=new Date;for(let n=0;n<24;n++){const t=new Date(o.getFullYear(),o.getMonth()-n,1),c=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`,d=t.toLocaleDateString("en-US",{year:"numeric",month:"long"});y.push({value:c,label:d})}return y}function Oe(){const[y,o]=x.useState(!1),[n,t]=x.useState("all"),[c,d]=x.useState("all"),[h,a]=x.useState("all"),[i,L]=x.useState(""),[F,z]=x.useState(""),{toast:$}=G();ne();const{data:H=[],isLoading:J}=B({queryKey:["/api/expenses"]}),{data:K=[]}=B({queryKey:["/api/owners"]}),ee=x.useMemo(()=>Ie(),[]),A=x.useMemo(()=>H.filter(s=>{var r;return!(n!=="all"&&(n==="common"&&s.allocation!=="common"||n!=="common"&&((r=s.ownerId)==null?void 0:r.toString())!==n)||c!=="all"&&s.expenseType!==c||h!=="all"&&s.expenseDate.substring(0,7)!==h||i&&s.expenseDate<i||F&&s.expenseDate>F)}),[H,n,c,h,i,F]),R=n!=="all"||c!=="all"||h!=="all"||i||F,se=()=>{t("all"),d("all"),a("all"),L(""),z("")},U=W({mutationFn:async s=>X("DELETE",`/api/expenses/${s}`),onSuccess:()=>{_.invalidateQueries({queryKey:["/api/expenses"]}),$({title:"Expense deleted successfully"})},onError:s=>{$({title:"Error",description:s.message,variant:"destructive"})}}),ae=()=>{o(!1)},O=s=>{const r=typeof s=="string"?parseFloat(s)||0:s;return Se(r)},te=A.reduce((s,r)=>s+parseFloat(r.amount),0),le=A.filter(s=>s.allocation==="common").reduce((s,r)=>s+parseFloat(r.amount),0);return J?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{className:"h-8 w-40"}),e.jsx(b,{className:"h-4 w-60 mt-2"})]}),e.jsx(b,{className:"h-9 w-32"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(b,{className:"h-24"}),e.jsx(b,{className:"h-24"})]}),e.jsx(E,{children:e.jsx(k,{className:"p-0",children:[1,2,3,4,5].map(s=>e.jsx(b,{className:"h-16 w-full"},s))})})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Expenses"}),e.jsx("p",{className:"text-muted-foreground",children:"Track operational costs and allocate to owners"})]}),e.jsxs(re,{open:y,onOpenChange:o,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(M,{"data-testid":"button-add-expense",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Record Expense"]})}),e.jsxs(ie,{className:"sm:max-w-lg",children:[e.jsx(oe,{children:e.jsx(de,{children:"Record Expense"})}),e.jsx(Me,{owners:K,onSuccess:ae})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(E,{className:"overflow-visible",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Total Expenses ",R&&"(Filtered)"]}),e.jsx("p",{className:"text-2xl font-semibold tabular-nums text-destructive",children:O(te)})]}),e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg bg-destructive/10 text-destructive",children:e.jsx(I,{className:"h-6 w-6"})})]})})}),e.jsx(E,{className:"overflow-visible",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Common Expenses ",R&&"(Filtered)"]}),e.jsx("p",{className:"text-2xl font-semibold tabular-nums",children:O(le)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Shared by all owners (20% each)"})]}),e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-lg bg-muted text-muted-foreground",children:e.jsx(Q,{className:"h-6 w-6"})})]})})})]}),e.jsx(E,{className:"overflow-visible",children:e.jsxs(k,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters"}),R&&e.jsxs(M,{variant:"ghost",size:"sm",onClick:se,className:"h-7 px-2 text-xs ml-auto",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),"Clear All"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Owner/Allocation"}),e.jsxs(S,{value:n,onValueChange:t,children:[e.jsx(C,{className:"h-9",children:e.jsx(D,{placeholder:"All"})}),e.jsxs(T,{children:[e.jsx(l,{value:"all",children:"All"}),e.jsx(l,{value:"common",children:"Common Expenses"}),K.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Category"}),e.jsxs(S,{value:c,onValueChange:d,children:[e.jsx(C,{className:"h-9",children:e.jsx(D,{placeholder:"All"})}),e.jsxs(T,{children:[e.jsx(l,{value:"all",children:"All Categories"}),Ae.map(s=>e.jsx(l,{value:s,className:"capitalize",children:s.charAt(0).toUpperCase()+s.slice(1)},s))]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Month"}),e.jsxs(S,{value:h,onValueChange:a,children:[e.jsx(C,{className:"h-9",children:e.jsx(D,{placeholder:"All Months"})}),e.jsxs(T,{children:[e.jsx(l,{value:"all",children:"All Months"}),ee.map(s=>e.jsx(l,{value:s.value,children:s.label},s.value))]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"From Date"}),e.jsx(w,{type:"date",value:i,onChange:s=>L(s.target.value),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"To Date"}),e.jsx(w,{type:"date",value:F,onChange:s=>z(s.target.value),className:"h-9"})]})]})]})}),e.jsx(E,{children:e.jsx(k,{className:"p-0",children:A.length>0?e.jsxs(he,{children:[e.jsx(ue,{children:e.jsxs(Z,{children:[e.jsx(u,{children:"Type"}),e.jsx(u,{children:"Date"}),e.jsx(u,{children:"Description"}),e.jsx(u,{children:"Allocation"}),e.jsx(u,{className:"text-right",children:"Amount"}),e.jsx(u,{children:"Receipt"}),e.jsx(u,{className:"w-[60px]"})]})}),e.jsx(je,{children:A.map(s=>{var q;const r=Ee[s.expenseType]||I;return e.jsxs(Z,{"data-testid":`row-expense-${s.id}`,children:[e.jsx(j,{children:e.jsxs(V,{className:ke[s.expenseType],variant:"secondary",children:[e.jsx(r,{className:"h-3 w-3 mr-1"}),s.expenseType]})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"}),new Date(s.expenseDate).toLocaleDateString()]})}),e.jsx(j,{children:e.jsx("span",{className:"truncate max-w-[200px] block",children:s.description})}),e.jsx(j,{children:s.allocation==="common"?e.jsxs(V,{variant:"outline",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"Common"]}):e.jsxs(V,{variant:"outline",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),((q=s.owner)==null?void 0:q.name)||"Owner"]})}),e.jsxs(j,{className:"text-right tabular-nums font-medium text-destructive",children:["-",O(s.amount)]}),e.jsx(j,{children:e.jsx("span",{className:"text-sm text-muted-foreground",children:s.receiptRef||"-"})}),e.jsx(j,{children:e.jsx(M,{variant:"ghost",size:"icon",onClick:()=>U.mutate(s.id),disabled:U.isPending,"data-testid":`button-delete-expense-${s.id}`,children:e.jsx(fe,{className:"h-4 w-4 text-destructive"})})})]},s.id)})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(I,{className:"h-12 w-12 text-muted-foreground/50 mb-4"}),e.jsx("h3",{className:"font-semibold mb-1",children:"No expenses recorded"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Track your operational costs"}),e.jsxs(M,{onClick:()=>o(!0),"data-testid":"button-add-first-expense",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Record Expense"]})]})})})]})}export{Oe as default};
