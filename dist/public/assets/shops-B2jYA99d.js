import{c as me,r as v,j as e,D as W,q as X,s as _,t as ee,ag as xe,ah as J,ai as ue,I as M,aj as he,m as o,o as se,e as Y,x as q,ak as je,S as L,p as pe,P as Z,C as V,a as P,al as ae,k as h,U as te,h as le,z as y,v as ge,w as fe,F as ve,y as w,A as S,E as b,G as C,H as D,a8 as I,a9 as O,aa as E,ab as R,ac as u,am as Ne,an as ye,ao as we,ap as Se,aq as be,ar as Ce,as as De,at as Te,J as $,K}from"./index-BFK3BxsS.js";import{T as Fe}from"./triangle-alert-Di3FTKlq.js";import{P as ke}from"./pen-C680T9lN.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=me("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);function Oe({isOpen:s,onClose:j,onConfirm:p,entityType:i,entityDescription:l,isPending:d=!1}){const[r,c]=v.useState(""),[g,N]=v.useState(new Date().toISOString().split("T")[0]),[f,m]=v.useState(""),t=()=>{if(!r.trim()){m("Please provide a reason for removal");return}m(""),p(r.trim(),g)},n=()=>{c(""),N(new Date().toISOString().split("T")[0]),m(""),j()};return e.jsx(W,{open:s,onOpenChange:n,children:e.jsxs(X,{className:"sm:max-w-md",children:[e.jsxs(_,{children:[e.jsxs(ee,{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(Fe,{className:"h-5 w-5"}),"Remove ",i]}),e.jsxs(xe,{children:["You are about to remove ",e.jsx("strong",{children:l}),". This record will be marked as deleted but will remain visible for historical reference."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"deletionReason",className:"text-sm font-medium",children:["Reason for Removal ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ue,{id:"deletionReason",value:r,onChange:T=>{c(T.target.value),f&&m("")},placeholder:"Please provide a reason for removing this record...",className:f?"border-red-500":"",rows:3}),f&&e.jsx("p",{className:"text-sm text-red-500",children:f})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"deletionDate",className:"text-sm font-medium",children:"Date of Removal"}),e.jsx(M,{id:"deletionDate",type:"date",value:g,onChange:T=>N(T.target.value)})]})]}),e.jsxs(he,{className:"gap-2",children:[e.jsx(o,{variant:"outline",onClick:n,disabled:d,children:"Cancel"}),e.jsx(o,{variant:"destructive",onClick:t,disabled:d,children:d?"Removing...":"Confirm Removal"})]})]})})}const Ee=y.object({shopNumber:y.string().min(1,"Shop number is required"),floor:y.enum(["ground","first","second","subedari"]),subedariCategory:y.enum(["shops","residential"]).optional(),status:y.enum(["vacant","occupied"]),ownershipType:y.enum(["sole","common"]),ownerId:y.string().optional(),description:y.string().optional()});function Re({shop:s,owners:j,onSuccess:p}){var m;const{toast:i}=se(),l=ge({resolver:fe(Ee),defaultValues:{shopNumber:(s==null?void 0:s.shopNumber)??"",floor:(s==null?void 0:s.floor)??"ground",subedariCategory:(s==null?void 0:s.subedariCategory)??void 0,status:(s==null?void 0:s.status)??"vacant",ownershipType:(s==null?void 0:s.ownershipType)??"sole",ownerId:((m=s==null?void 0:s.ownerId)==null?void 0:m.toString())??"",description:(s==null?void 0:s.description)??""}}),d=l.watch("ownershipType"),r=l.watch("floor"),c=q({mutationFn:async t=>{const n={...t,ownerId:t.ownershipType==="common"?null:t.ownerId?parseInt(t.ownerId):null};return $("POST","/api/shops",n)},onSuccess:()=>{K.invalidateQueries({queryKey:["/api/shops"]}),i({title:"Shop created successfully"}),p()},onError:t=>{i({title:"Error",description:t.message,variant:"destructive"})}}),g=q({mutationFn:async t=>{const n={...t,ownerId:t.ownershipType==="common"?null:t.ownerId?parseInt(t.ownerId):null};return $("PATCH",`/api/shops/${s==null?void 0:s.id}`,n)},onSuccess:()=>{K.invalidateQueries({queryKey:["/api/shops"]}),i({title:"Shop updated successfully"}),p()},onError:t=>{i({title:"Error",description:t.message,variant:"destructive"})}}),N=t=>{s?g.mutate(t):c.mutate(t)},f=c.isPending||g.isPending;return e.jsx(ve,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(N),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(w,{control:l.control,name:"shopNumber",render:({field:t})=>e.jsxs(S,{children:[e.jsx(b,{children:"Shop Number *"}),e.jsx(C,{children:e.jsx(M,{...t,placeholder:"e.g., G-01","data-testid":"input-shop-number"})}),e.jsx(D,{})]})}),e.jsx(w,{control:l.control,name:"floor",render:({field:t})=>e.jsxs(S,{children:[e.jsx(b,{children:"Location *"}),e.jsxs(I,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(C,{children:e.jsx(O,{"data-testid":"select-shop-floor",children:e.jsx(E,{placeholder:"Select location"})})}),e.jsxs(R,{children:[e.jsx(u,{value:"ground",children:"Ground Floor"}),e.jsx(u,{value:"first",children:"1st Floor"}),e.jsx(u,{value:"second",children:"2nd Floor"}),e.jsx(u,{value:"subedari",children:"Subedari"})]})]}),e.jsx(D,{})]})})]}),r==="subedari"&&e.jsx(w,{control:l.control,name:"subedariCategory",render:({field:t})=>e.jsxs(S,{children:[e.jsx(b,{children:"Category *"}),e.jsxs(I,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(C,{children:e.jsx(O,{"data-testid":"select-subedari-category",children:e.jsx(E,{placeholder:"Select category"})})}),e.jsxs(R,{children:[e.jsx(u,{value:"shops",children:"Shops"}),e.jsx(u,{value:"residential",children:"Residential"})]})]}),e.jsx(D,{})]})}),e.jsx(w,{control:l.control,name:"status",render:({field:t})=>e.jsxs(S,{children:[e.jsx(b,{children:"Status *"}),e.jsxs(I,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(C,{children:e.jsx(O,{"data-testid":"select-shop-status",children:e.jsx(E,{placeholder:"Select status"})})}),e.jsxs(R,{children:[e.jsx(u,{value:"vacant",children:"Vacant"}),e.jsx(u,{value:"occupied",children:"Occupied"})]})]}),e.jsx(D,{})]})}),e.jsx(w,{control:l.control,name:"ownershipType",render:({field:t})=>e.jsxs(S,{children:[e.jsx(b,{children:"Ownership Type *"}),e.jsxs(I,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(C,{children:e.jsx(O,{"data-testid":"select-ownership-type",children:e.jsx(E,{placeholder:"Select ownership type"})})}),e.jsxs(R,{children:[e.jsx(u,{value:"sole",children:"Sole Owner"}),e.jsx(u,{value:"common",children:"Common (Shared)"})]})]}),e.jsx(Ne,{children:t.value==="common"?"Revenue will be shared among all owners (20% each)":"Linked to a single owner"}),e.jsx(D,{})]})}),d==="sole"&&e.jsx(w,{control:l.control,name:"ownerId",render:({field:t})=>e.jsxs(S,{children:[e.jsx(b,{children:"Owner *"}),e.jsxs(I,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(C,{children:e.jsx(O,{"data-testid":"select-shop-owner",children:e.jsx(E,{placeholder:"Select owner"})})}),e.jsx(R,{children:j.map(n=>e.jsx(u,{value:n.id.toString(),children:n.name},n.id))})]}),e.jsx(D,{})]})}),e.jsx(w,{control:l.control,name:"description",render:({field:t})=>e.jsxs(S,{children:[e.jsx(b,{children:"Description"}),e.jsx(C,{children:e.jsx(M,{...t,placeholder:"Additional notes about the shop","data-testid":"input-shop-description"})}),e.jsx(D,{})]})}),e.jsx("div",{className:"flex justify-end gap-2 pt-4",children:e.jsx(o,{type:"submit",disabled:f,"data-testid":"button-save-shop",children:f?"Saving...":s?"Update Shop":"Add Shop"})})]})})}function Ae({shop:s,onEdit:j,onDelete:p}){const i=s.isDeleted,l=s.deletedAt,d=s.deletionReason,r=c=>c?new Date(c).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"N/A";return e.jsx(V,{className:`overflow-visible hover-elevate ${i?"opacity-60":""}`,"data-testid":`card-shop-${s.id}`,children:e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex h-10 w-10 items-center justify-center rounded-md ${i?"bg-muted text-muted-foreground":"bg-primary/10 text-primary"}`,children:e.jsx(le,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold ${i?"line-through text-muted-foreground":""}`,children:["Shop ",s.shopNumber]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ae(s.floor,s.subedariCategory)})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>j(s),"data-testid":`button-edit-shop-${s.id}`,children:e.jsx(ke,{className:"h-4 w-4"})}),!i&&e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>p(s.id),"data-testid":`button-delete-shop-${s.id}`,children:e.jsx(ye,{className:"h-4 w-4 text-destructive"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[i&&e.jsx(we,{children:e.jsxs(Se,{children:[e.jsx(be,{asChild:!0,children:e.jsxs(h,{variant:"destructive",className:"gap-1 cursor-help",children:["Voided",e.jsx(Ce,{className:"h-3 w-3"})]})}),e.jsx(De,{className:"max-w-xs",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Removed on:"})," ",r(l)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Reason:"})," ",d||"No reason provided"]})]})})]})}),e.jsx(h,{className:Te(s.status),children:s.status==="occupied"?"Occupied":"Vacant"}),e.jsx(h,{variant:"outline",children:s.ownershipType==="common"?"Common":"Sole Owner"})]}),s.ownershipType==="sole"&&s.owner&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{children:s.owner.name})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2 line-clamp-2",children:s.description})]})})}function ze(){const[s,j]=v.useState(!1),[p,i]=v.useState(null),[l,d]=v.useState("all"),[r,c]=v.useState("all"),[g,N]=v.useState(null),[f,m]=v.useState(!1),{toast:t}=se(),{data:n=[],isLoading:T}=Y({queryKey:["/api/shops"]}),{data:G=[]}=Y({queryKey:["/api/owners"]}),B=q({mutationFn:async({id:a,reason:x,deletionDate:k})=>$("DELETE",`/api/shops/${a}`,{reason:x,deletionDate:k}),onSuccess:()=>{K.invalidateQueries({queryKey:["/api/shops"]}),t({title:"Shop removed successfully"}),m(!1),N(null)},onError:a=>{t({title:"Error",description:a.message,variant:"destructive"})}}),ne=a=>{i(a),j(!0)},re=()=>{j(!1),i(null)},ie=a=>{N(a),m(!0)},oe=(a,x)=>{g&&B.mutate({id:g,reason:a,deletionDate:x})},de=()=>{m(!1),N(null)},Q=n.find(a=>a.id===g),H=je(n.filter(a=>{var A;const x=l==="all"||a.floor===l,k=r==="all"||r==="common"&&a.ownershipType==="common"||((A=a.ownerId)==null?void 0:A.toString())===r;return x&&k}),a=>a.floor,a=>a.shopNumber),F={ground:n.filter(a=>a.floor==="ground"),first:n.filter(a=>a.floor==="first"),second:n.filter(a=>a.floor==="second"),subedari:n.filter(a=>a.floor==="subedari")},ce=a=>n.filter(x=>x.ownerId===a).length,U=n.filter(a=>a.ownershipType==="common").length;return T?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(L,{className:"h-8 w-40"}),e.jsx(L,{className:"h-4 w-60 mt-2"})]}),e.jsx(L,{className:"h-9 w-32"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[1,2,3,4,5,6,7,8].map(a=>e.jsx(L,{className:"h-48"},a))})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Shops"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage all shop units across the building"})]}),e.jsxs(W,{open:s,onOpenChange:j,children:[e.jsx(pe,{asChild:!0,children:e.jsxs(o,{onClick:()=>i(null),"data-testid":"button-add-shop",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Add Shop"]})}),e.jsxs(X,{className:"sm:max-w-lg",children:[e.jsx(_,{children:e.jsx(ee,{children:p?"Edit Shop":"Add New Shop"})}),e.jsx(Re,{shop:p??void 0,owners:G,onSuccess:re})]})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:Object.entries(F).map(([a,x])=>{const k=x.filter(z=>z.status==="occupied").length,A=x.filter(z=>z.status==="vacant").length;return e.jsx(V,{className:"overflow-visible",children:e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:ae(a)}),e.jsx("p",{className:"text-2xl font-semibold",children:x.length})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"text-emerald-600 dark:text-emerald-400",children:[k," occupied"]}),e.jsxs("div",{className:"text-blue-600 dark:text-blue-400",children:[A," vacant"]})]})]})})},a)})}),e.jsx(V,{className:"overflow-visible",children:e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Location"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(o,{variant:l==="all"?"default":"outline",size:"sm",onClick:()=>d("all"),className:"h-8","data-testid":"filter-all-floors",children:["All",e.jsx(h,{variant:"secondary",className:"ml-1.5 px-1.5 py-0 text-xs",children:n.length})]}),e.jsxs(o,{variant:l==="ground"?"default":"outline",size:"sm",onClick:()=>d("ground"),className:"h-8","data-testid":"filter-ground-floor",children:["Ground",e.jsx(h,{variant:"secondary",className:"ml-1.5 px-1.5 py-0 text-xs",children:F.ground.length})]}),e.jsxs(o,{variant:l==="first"?"default":"outline",size:"sm",onClick:()=>d("first"),className:"h-8","data-testid":"filter-first-floor",children:["1st",e.jsx(h,{variant:"secondary",className:"ml-1.5 px-1.5 py-0 text-xs",children:F.first.length})]}),e.jsxs(o,{variant:l==="second"?"default":"outline",size:"sm",onClick:()=>d("second"),className:"h-8","data-testid":"filter-second-floor",children:["2nd",e.jsx(h,{variant:"secondary",className:"ml-1.5 px-1.5 py-0 text-xs",children:F.second.length})]}),e.jsxs(o,{variant:l==="subedari"?"default":"outline",size:"sm",onClick:()=>d("subedari"),className:"h-8","data-testid":"filter-subedari",children:["Subedari",e.jsx(h,{variant:"secondary",className:"ml-1.5 px-1.5 py-0 text-xs",children:F.subedari.length})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Owner"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(o,{variant:r==="all"?"default":"outline",size:"sm",onClick:()=>c("all"),className:"h-8","data-testid":"filter-all-owners",children:["All",e.jsx(h,{variant:"secondary",className:"ml-1.5 px-1.5 py-0 text-xs",children:n.length})]}),G.map(a=>e.jsxs(o,{variant:r===a.id.toString()?"default":"outline",size:"sm",onClick:()=>c(a.id.toString()),className:"h-8","data-testid":`filter-owner-${a.id}`,children:[a.name,e.jsx(h,{variant:"secondary",className:"ml-1.5 px-1.5 py-0 text-xs",children:ce(a.id)})]},a.id)),U>0&&e.jsxs(o,{variant:r==="common"?"default":"outline",size:"sm",onClick:()=>c("common"),className:"h-8","data-testid":"filter-common-shops",children:["Common",e.jsx(h,{variant:"secondary",className:"ml-1.5 px-1.5 py-0 text-xs",children:U})]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[H.map(a=>e.jsx(Ae,{shop:a,onEdit:ne,onDelete:ie},a.id)),H.length===0&&e.jsx(V,{className:"col-span-full",children:e.jsxs(P,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(le,{className:"h-12 w-12 text-muted-foreground/50 mb-4"}),e.jsx("h3",{className:"font-semibold mb-1",children:"No shops found"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:l==="all"&&r==="all"?"Add your first shop to get started":"No shops matching the selected filters"}),l==="all"&&r==="all"&&e.jsxs(o,{onClick:()=>j(!0),"data-testid":"button-add-first-shop",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Add Shop"]}),(l!=="all"||r!=="all")&&e.jsx(o,{variant:"outline",onClick:()=>{d("all"),c("all")},children:"Clear Filters"})]})})]}),e.jsx(Oe,{isOpen:f,onClose:de,onConfirm:oe,entityType:"Shop",entityDescription:Q?`Shop ${Q.shopNumber}`:"",isPending:B.isPending})]})}export{ze as default};
